/*
 * File: app/view/UserDsp.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('TeamDomain.view.UserDsp', {
    extend: 'Ext.window.Window',
    alias: 'widget.UserDsp',
    height: 600,
    hidden: false,
    id: 'userDsp',
    itemId: 'userDsp',
    width: 950,
    modal: true,
    layout: {
        align: 'stretch',
        type: 'hbox'
    },
    title: 'ユーザ管理',
    constrain: true,
    initComponent: function () {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'gridpanel',
                    flex: 1,
                    id: 'UserManagementList',
                    itemId: 'userManagementList',
                    autoScroll: true,
                    store: 'MemberManagementDataStore',
                    dockedItems: [
                        {
                            xtype: 'pagingtoolbar',
                            dock: 'bottom',
                            id: 'Members_page_bar',
                            displayInfo: true,
                            store: 'MemberManagementDataStore',
                            listeners:
                                    {
                                        beforechange: function (pbar, params)
                                        {
                                            store = Ext.getStore('MemberManagementDataStore');
                                            var formData = Ext.getCmp('tabpanel1').activeTab.items.items[0].getForm().getValues();
                                            Ext.apply(store.proxy.extraParams,
                                                    {
                                                        user_name: formData.user_name,
                                                        real_uname: formData.real_uname,
                                                        user_post: formData.user_post,
                                                        user_mail: formData.user_mail,
                                                        company_name: formData.company_name,
                                                        employee_number: formData.employee_number,
                                                        p_group_name: formData.p_group_name,
                                                        p_group_description: formData.p_group_description
                                                    });
                                        }
                                    }
                        }
                    ],
                    selModel: Ext.create('Ext.selection.RowModel', {
                        listeners: {
                            select: {
                                fn: me.onRowModelSelect,
                                scope: me
                            }
                        }
                    }),
                    columns: [
                        {
                            xtype: 'gridcolumn',
                            hidden: true,
                            dataIndex: 'hash_key',
                            hideable: false,
                            text: 'Hash_key'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 60,
                            dataIndex: 'user_id',
                            text: 'UID'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'user_name',
                            text: 'ユーザー名'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'real_uname',
                            text: '氏名'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'user_mail',
                            text: 'メール'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'company_name',
                            text: '会社名'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'user_post',
                            text: '部署'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'employee_number',
                            text: '社員番号'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'user_directory',
                            text: 'ディレクトリ'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'user_pw',
                            text: 'パスワード'
                        },
                        {
                            xtype: 'gridcolumn',
                            width: 60,
                            dataIndex: 'p_group_id',
                            text: 'GID'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'p_group_name',
                            text: 'グループ名'
                        },
                        {
                            xtype: 'gridcolumn',
                            dataIndex: 'p_group_description',
                            text: 'グループ補助名'
                        }
                    ]
                },
                {
                    xtype: 'tabpanel',
                    id: 'tabpanel1',
                    width: 350,
                    activeTab: 0,
                    items: [
                        {
                            xtype: 'panel',
                            layout: {
                                type: 'fit'
                            },
                            iconCls: '',
                            title: '追加',
                            tabConfig: {
                                xtype: 'tab',
                                icon: 'data/small_icon/add_small.png'
                            },
                            items: [
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'UserCreateForm',
                                    itemId: 'userCreateForm',
                                    autoScroll: true,
                                    bodyPadding: 10,
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            items: [
                                                {
                                                    xtype: 'tbfill'
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/add_small.png',
                                                    tooltip: '追加実行',
                                                    tooltipType: 'title',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick,
                                                            scope: me
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/Search.png',
                                                    tooltip: '検索',
                                                    tooltipType: 'title',
                                                    id: '#userCreateForm',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick3,
                                                            scope: me
                                                        }
                                                    }}
                                            ]
                                        }
                                    ],
                                    items: [
                                        {
                                            xtype: 'label',
                                            text: '*印のある項目は入力必須'
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'ユーザー',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'UID',
                                                    labelWidth: 140,
                                                    name: 'user_id',
                                                    allowBlank: false},
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'ユーザー名*',
                                                    labelWidth: 140,
                                                    name: 'user_name',
                                                    id: '#userCreateForm_user_name',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '氏名',
                                                    labelWidth: 140,
                                                    name: 'real_uname'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'メールアドレス',
                                                    labelWidth: 140,
                                                    name: 'user_mail',
                                                    id: 'user_mail',
                                                    vtype: 'email'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '会社名',
                                                    labelWidth: 140,
                                                    name: 'company_name'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '部署',
                                                    labelWidth: 140,
                                                    name: 'user_post'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '社員番号',
                                                    labelWidth: 140,
                                                    name: 'employee_number'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'パスワード*',
                                                    labelWidth: 140,
                                                    name: 'user_pw',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'ログインディレクトリ',
                                                    labelWidth: 140,
                                                    name: 'user_directory'
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ログインディレクトリが未入力の場合には、ユーザホームディレクトリを指定したことになります。)'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'プライマリ・グループ',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'GID',
                                                    labelStyle: '',
                                                    labelWidth: 140,
                                                    name: 'p_group_id',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ユーザーがどこのグループにも属さない場合には、UIDと同じIDを入力して下さい。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ名*',
                                                    labelWidth: 140,
                                                    name: 'p_group_name',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(既存のGIDと入力したグループ名が一致しない場合には、GIDを優先します。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ補助名',
                                                    labelWidth: 140,
                                                    name: 'p_group_description'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'panel',
                            layout: {
                                type: 'fit'
                            },
                            title: '更新',
                            tabConfig: {
                                xtype: 'tab',
                                icon: 'data/small_icon/modify_small.png'
                            },
                            items: [
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'UserUpdateForm',
                                    itemId: 'userUpdateForm',
                                    autoScroll: true,
                                    bodyPadding: 10,
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            hidden: true,
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'label',
                                            text: '*印のある項目は入力必須'
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'ユーザー',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'UID',
                                                    labelWidth: 140,
                                                    name: 'user_id',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'ユーザー名*',
                                                    labelWidth: 140,
                                                    name: 'user_name',
                                                    id: '#userUpdateForm_user_name',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '氏名',
                                                    labelWidth: 140,
                                                    name: 'real_uname'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'メールアドレス',
                                                    labelWidth: 140,
                                                    name: 'user_mail',
                                                    id: 'user_mail1',
                                                    vtype: 'email'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '会社名',
                                                    labelWidth: 140,
                                                    name: 'company_name'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '部署',
                                                    labelWidth: 140,
                                                    name: 'user_post'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '社員番号',
                                                    labelWidth: 140,
                                                    name: 'employee_number'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'パスワード*',
                                                    labelWidth: 140,
                                                    name: 'user_pw',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'ログインディレクトリ',
                                                    labelWidth: 140,
                                                    name: 'user_directory'
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ログインディレクトリが未入力の場合には、ユーザホームディレクトリを指定したことになります。)'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'プライマリ・グループ',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'GID',
                                                    labelStyle: '',
                                                    labelWidth: 140,
                                                    name: 'p_group_id',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ユーザーがどこのグループにも属さない場合には、UIDと同じIDを入力して下さい。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ名*',
                                                    labelWidth: 140,
                                                    name: 'p_group_name',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(既存のGIDと入力したグループ名が一致しない場合には、GIDを優先します。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ補助名',
                                                    labelWidth: 140,
                                                    name: 'p_group_description'
                                                }
                                            ]
                                        }
                                    ],
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            items: [
                                                {
                                                    xtype: 'tbfill'
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/modify_small.png',
                                                    tooltip: '更新実行',
                                                    tooltipType: 'title',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick1,
                                                            scope: me
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/Search.png',
                                                    tooltip: '検索',
                                                    id: '#userUpdateForm',
                                                    tooltipType: 'title',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick3,
                                                            scope: me
                                                        }
                                                    }}
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'panel',
                            layout: {
                                type: 'fit'
                            },
                            title: '削除',
                            tabConfig: {
                                xtype: 'tab',
                                icon: 'data/small_icon/delete_small.png'
                            },
                            items: [
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'UserDeleteForm',
                                    itemId: 'userDeleteForm',
                                    autoScroll: true,
                                    bodyPadding: 10,
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            hidden: true,
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'ユーザー',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'UID',
                                                    labelWidth: 140,
                                                    name: 'user_id',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'ユーザー名',
                                                    labelWidth: 140,
                                                    name: 'user_name',
                                                    id: '#userDeleteForm_user_name',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '氏名',
                                                    labelWidth: 140,
                                                    name: 'real_uname',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'メールアドレス',
                                                    labelWidth: 140,
                                                    name: 'user_mail',
                                                    id: 'user_name2',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '会社名',
                                                    labelWidth: 140,
                                                    name: 'company_name',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '部署',
                                                    labelWidth: 140,
                                                    name: 'user_post',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '社員番号',
                                                    labelWidth: 140,
                                                    name: 'employee_number',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'パスワード',
                                                    labelWidth: 140,
                                                    name: 'user_pw',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'ログインディレクトリ',
                                                    labelWidth: 140,
                                                    name: 'user_directory',
                                                    readOnly: true
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ログインディレクトリが未入力の場合には、ユーザホームディレクトリを指定したことになります。)'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: 'プライマリ・グループ',
                                            items: [
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    hidden: true,
                                                    fieldLabel: 'GID',
                                                    labelStyle: '',
                                                    labelWidth: 140,
                                                    name: 'p_group_id',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(ユーザーがどこのグループにも属さない場合には、UIDと同じIDを入力して下さい。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ名*',
                                                    labelWidth: 140,
                                                    name: 'p_group_name',
                                                    readOnly: true,
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'label',
                                                    hidden: true,
                                                    style: {
                                                        color: 'orange',
                                                        'font-style': 'italic'
                                                    },
                                                    text: '(既存のGIDと入力したグループ名が一致しない場合には、GIDを優先します。)'
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: 'グループ補助名',
                                                    labelWidth: 140,
                                                    name: 'p_group_description',
                                                    readOnly: true
                                                }
                                            ]
                                        }
                                    ],
                                    dockedItems: [
                                        {
                                            xtype: 'toolbar',
                                            dock: 'top',
                                            items: [
                                                {
                                                    xtype: 'tbfill'
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/delete_small.png',
                                                    tooltip: '削除実行',
                                                    tooltipType: 'title',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick2,
                                                            scope: me
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'button',
                                                    icon: 'data/small_icon/Search.png',
                                                    tooltip: '検索',
                                                    id: '#userDeleteForm',
                                                    tooltipType: 'title',
                                                    listeners: {
                                                        click: {
                                                            fn: me.onButtonClick3,
                                                            scope: me
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'hidden',
                    id: 'select_flag',
                    value: false
                }
            ],
            listeners: {
                afterrender: {
                    fn: me.onPanelAfterRender,
                    scope: me
                }
            }
        });

        me.callParent(arguments);
    },
    onRowModelSelect: function (rowmodel, record, index, eOpts) {
        Ext.getCmp('UserUpdateForm').getForm().setValues({
            user_id: record.data.user_id,
            user_name: record.data.user_name,
            real_uname: record.data.real_uname,
            user_mail: record.data.user_mail,
            company_name: record.data.company_name,
            employee_number: record.data.employee_number,
            user_post: record.data.user_post,
            user_pw: record.data.user_pw,
            user_directory: record.data.user_directory,
            p_group_id: record.data.p_group_id,
            p_group_name: record.data.p_group_name,
            p_group_description: record.data.p_group_description
        });

        Ext.getCmp('UserDeleteForm').getForm().setValues({
            user_id: record.data.user_id,
            user_name: record.data.user_name,
            real_uname: record.data.real_uname,
            user_mail: record.data.user_mail,
            company_name: record.data.company_name,
            employee_number: record.data.employee_number,
            user_post: record.data.user_post,
            user_pw: record.data.user_pw,
            user_directory: record.data.user_directory,
            p_group_id: record.data.p_group_id,
            p_group_name: record.data.p_group_name,
            p_group_description: record.data.p_group_description
        });
    },
    onButtonClick: function (button, e, eOpts) {
        var formData = Ext.ComponentQuery.query('#userCreateForm')[0].getForm().getValues();

        //!formData.user_id || !formData.p_group_idを外した。(20140211)
        //if (!formData.user_name || !formData.user_pw || !formData.p_group_name) { 
        if (!formData.user_name || !formData.user_pw || !formData.p_group_name) {
            Ext.Msg.show({
                title: 'データ入力',
                msg: '*印のついたすべてのデータを入力してください',
                buttons: Ext.Msg.OK
            });
            return;
        }

        if (formData.user_name.trim().length < 1 || formData.user_pw.trim().length < 1 || formData.p_group_name.trim().length < 1)
        {
            
            Ext.Msg.show({
                //title:'新規グループ名・説明入力',
                //msg: '新規グループ名/説明を入力して下さい。',
                title: '入力エラー',
                msg: '半角、全角スペースのみは許可されません。',
                icon: Ext.Msg.ERROR,
                buttons: Ext.Msg.OK
            });
            return;
        }


        if (!Ext.getCmp('user_mail').isValid())
        {
            Ext.Msg.show({
                title: '入力エラー',
                msg: '{ユーザ名}@{ドメイン名}の形式で入力してください',
                buttons: Ext.Msg.OK
            });
            return;
        }

        formData = Ext.apply({session_id: this_session_id}, {formData: formData});
        var sendingData = Ext.apply({request_type: "createUser"}, formData);
        sendingData=Ext.apply({is_sticky:true}, sendingData);
        Ext.Ajax.request({
            url: 'tdx/updatedata.tdx',
            //url: 'php/request.php',
            jsonData: sendingData,
            success: handlerSuccess,
            failure: handlerFailure
        });

        function handlerSuccess(response) {
            obj = Ext.decode(response.responseText);
            var request_success = obj.success;
            if (request_success === false) {
                var request_errors = obj.errors;
                Ext.Msg.show({
                    title: 'ユーザ追加失敗',
                    msg: request_errors,
                    buttons: Ext.Msg.OK
                });
            } else {
                Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();
                Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().reset();
                Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().reset();
                Ext.getStore('MemberManagementDataStore').load();
                Ext.getCmp('Members_page_bar').moveFirst();
            }
        }

        function handlerFailure(response) {
            Ext.Msg.show({
                title: 'データ送信失敗',
                msg: 'サーバとの通信に失敗しました',
                buttons: Ext.Msg.OK
            });
            return;
        }
    },
    onButtonClick1: function (button, e, eOpts) {
        var formData = Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().getValues();

        //!formData.user_id || !formData.p_group_id
        //if (!formData.user_name || !formData.user_pw || !formData.p_group_name) {
        if (!formData.user_name || !formData.user_pw || !formData.p_group_name) {
            Ext.Msg.show({
                title: 'データ入力',
                msg: '*印のついたすべてのデータを入力してください',
                buttons: Ext.Msg.OK
            });
            return;
        }

        if (formData.user_name.trim().length < 1 || formData.user_pw.trim().length < 1 || formData.p_group_name.trim().length < 1)
        {
            
            Ext.Msg.show({
                //title:'新規グループ名・説明入力',
                //msg: '新規グループ名/説明を入力して下さい。',
                title: '入力エラー',
                msg: '半角、全角スペースのみは許可されません。',
                icon: Ext.Msg.ERROR,
                buttons: Ext.Msg.OK
            });
            return;
        }

        if (!Ext.getCmp('user_mail').isValid())
        {
            Ext.Msg.show({
                title: '入力エラー',
                msg: '{ユーザ名}@{ドメイン名}の形式で入力してください',
                buttons: Ext.Msg.OK
            });
            return;
        }

        formData = Ext.apply({session_id: this_session_id}, {formData: formData});
        var sendingData = Ext.apply({request_type: "updateUser"}, formData);

        Ext.Ajax.request({
            url: 'tdx/updatedata.tdx',
            //url: 'php/request.php',
            jsonData: sendingData,
            success: handlerSuccess,
            failure: handlerFailure
        });

        function handlerSuccess(response) {
            obj = Ext.decode(response.responseText);
            var request_success = obj.success;
            if (request_success === false) {
                var request_errors = obj.errors;
                Ext.Msg.show({
                    title: 'ユーザデータ更新失敗',
                    msg: request_errors,
                    buttons: Ext.Msg.OK
                });
            } else {
                Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();
                Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().reset();
                Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().reset();
                Ext.getStore('MemberManagementDataStore').load();
            }
        }

        function handlerFailure(response) {
            Ext.Msg.show({
                title: 'データ送信失敗',
                msg: 'サーバとの通信に失敗しました',
                buttons: Ext.Msg.OK
            });
        }

    },
    onButtonClick2: function (button, e, eOpts) {
        var formData = Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().getValues();

        formData = Ext.apply({session_id: this_session_id}, {formData: formData});
        var sendingData = Ext.apply({request_type: "deleteUser"}, formData);
        Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();

        Ext.Ajax.request({
            url: 'tdx/updatedata.tdx',
            //url: 'php/request.php',
            jsonData: sendingData,
            success: handlerSuccess,
            failure: handlerFailure
        });

        function handlerSuccess(response) {
            obj = Ext.decode(response.responseText);
            var request_success = obj.success;
            if (request_success === false) {
                var request_errors = obj.errors;
                Ext.Msg.show({
                    title: 'ユーザ削除失敗',
                    msg: request_errors,
                    buttons: Ext.Msg.OK
                });
            } else {
                Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();
                Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().reset();
                Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().reset();
                Ext.getStore('MemberManagementDataStore').load();
            }
        }

        function handlerFailure(response) {
            Ext.Msg.show({
                title: 'データ送信失敗',
                msg: 'サーバとの通信に失敗しました',
                buttons: Ext.Msg.OK
            });
            return;
        }
    },
    onButtonClick3: function (button, e, eOpts) {
        var selectProxy;
        var form = Ext.ComponentQuery.query(button.id)[0].getForm();
        var formData = form.getValues();
        Ext.getCmp(button.id + '_user_name').allowBlank = true;
        Ext.getCmp(button.id + '_user_name').clearInvalid();
        //!formData.user_id || !formData.p_group_idを外した。(20140211)
        //if (!formData.user_name || !formData.user_pw || !formData.p_group_name) { 
        if (!formData.user_name) {
            selectProxy = new Ext.data.proxy.Ajax({
                type: 'ajax',
                url: 'spin/user_list.sfl',
                actionMethods: {
                    create: 'POST',
                    read: 'POST',
                    update: 'POST',
                    destroy: 'POST'
                },
                reader: {
                    type: 'json',
                    root: 'users'
                }
            });
        }
        else
        {
            selectProxy = new Ext.data.proxy.Ajax({
                type: 'ajax',
                url: 'spin/select_list.sfl',
                actionMethods: {
                    create: 'POST',
                    read: 'POST',
                    update: 'POST',
                    destroy: 'POST'
                },
                reader: {
                    type: 'json',
                    root: 'users'
                }
            });
        }
        //formData = Ext.apply({session_id: this_session_id}, {formData: formData});
        //var sendingData = Ext.apply({request_type: "selectUser"},formData);
        Ext.getStore('MemberManagementDataStore').setProxy(selectProxy);
        Ext.getStore('MemberManagementDataStore').load({
            params: {
                user_name: formData.user_name,
                user_post: formData.user_post,
                user_mail: formData.user_mail,
                real_uname: formData.real_uname,
                company_name: formData.company_name,
                employee_number: formData.employee_number,
                p_group_name: formData.p_group_name,
                p_group_description: formData.p_group_description
            },
            callback: function (records, operation, success)
            {
                if (success === true)
                {
                    Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();
                    //Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().reset();
                    Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().reset();
                    Ext.getCmp('Members_page_bar').moveFirst();
                    Ext.getCmp(button.id + '_user_name').allowBlank = false;
                }
                else
                {
                    Ext.Msg.show({
                        title: 'データ送信失敗',
                        msg: 'サーバとの通信に失敗しました',
                        buttons: Ext.Msg.OK
                    });
                    return;
                }
            }
        });

        /*Ext.Ajax.request({
         url: 'tdx/updatedata.tdx',
         //url: 'php/request.php',
         jsonData: sendingData,
         success: handlerSuccess,
         failure: handlerFailure
         });*/

        function handlerSuccess(response) {
            obj = Ext.decode(response.responseText);
            var request_success = obj.success;
            console.log(response);
            if (request_success === false) {
                var request_errors = obj.errors;
                Ext.Msg.show({
                    title: 'ユーザ検索失敗',
                    msg: request_errors,
                    buttons: Ext.Msg.OK
                });
            } else {

                Ext.ComponentQuery.query('#userManagementList')[0].getSelectionModel().deselectAll();
                Ext.ComponentQuery.query('#userUpdateForm')[0].getForm().reset();
                Ext.ComponentQuery.query('#userDeleteForm')[0].getForm().reset();
                Ext.getCmp('Members_page_bar').moveFirst();
                Ext.ComponentQuery.query(button.id)[0].getForm().items[1].items[1].allowBlank = false;
            }
        }

        function handlerFailure(response) {
            Ext.Msg.show({
                title: 'データ送信失敗',
                msg: 'サーバとの通信に失敗しました',
                buttons: Ext.Msg.OK
            });
            return;
        }
    },
    onPanelAfterRender: function (component, eOpts) {
        Ext.getStore('MemberManagementDataStore').load();
    }
});


