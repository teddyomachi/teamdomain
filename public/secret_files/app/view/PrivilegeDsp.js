/*
 * File: app/view/PrivilegeDsp.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('TeamDomain.view.PrivilegeDsp', {
    extend: 'Ext.window.Window',
    alias: 'widget.privilegedsp',
    height: 600,
    hidden: false,
    id: 'privilegedsp',
    itemId: 'privilegedsp',
    width: 950,
    modal: true,
    layout: {
        type: 'fit'
    },
    title: 'アクセス権設定',
    constrain: true,
    initComponent: function () {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'panel',
                    id: 'folderAccess',
                    layout: {
                        align: 'stretch',
                        type: 'hbox'
                    },
                    title: 'フォルダのアクセス権',
                    tabConfig: {
                        xtype: 'tab',
                        flex: 1,
                        autoWidth: true,
                        listeners: {
                            click: {
                                fn: me.onTabClick1,
                                scope: me
                            }
                        }
                    },
                    items: [
                        {
                            xtype: 'form',
                            flex: 1,
                            frame: true,
                            id: 'folderPrivilege',
                            layout: {
                                align: 'stretch',
                                type: 'vbox'
                            },
                            bodyPadding: 5,
                            items: [
                                {
                                    xtype: 'fieldset',
                                    height: 50,
                                    margin: 0,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    title: 'フォルダのアクセス権を設定',
                                    items: [
                                        {
                                            xtype: 'displayfield',
                                            flex: 1,
                                            height: 20,
                                            padding: 0,
                                            name: 'text'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            flex: 1,
                                            height: 20,
                                            padding: 0,
                                            fieldLabel: '所有者',
                                            name: 'owner_name'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'hash_key',
                                            id: 'hash_key'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    height: 100,
                                    margin: '3 0 0 0',
                                    maxHeight: 130,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    items: [
                                        {
                                            xtype: 'fieldset',
                                            flex: 1,
                                            height: 70,
                                            id: 'privilege_folder_range',
                                            margin: '0 5 0 0',
                                            maxHeight: 100,
                                            minHeight: 70,
                                            layout: {
                                                align: 'stretch',
                                                type: 'vbox'
                                            },
                                            title: '範囲',
                                            items: [
                                                {
                                                    xtype: 'radiofield',
                                                    cls: 'label-s',
                                                    margin: 0,
                                                    name: 'range',
                                                    boxLabel: '下位の全階層フォルダも含む',
                                                    checked: true,
                                                    inputValue: 'all_folders'
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    cls: 'label-s',
                                                    margin: 0,
                                                    name: 'range',
                                                    boxLabel: 'カレントフォルダのみ',
                                                    inputValue: 'folder'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'fieldset',
                                            flex: 1,
                                            height: 80,
                                            id: 'privilege_folder_target',
                                            margin: 0,
                                            maxHeight: 100,
                                            minHeight: 70,
                                            padding: '0 10 -5 10',
                                            layout: {
                                                align: 'stretch',
                                                padding: 0,
                                                type: 'vbox'
                                            },
                                            title: '対象',
                                            items: [
                                                {
                                                    xtype: 'radiofield',
                                                    cls: 'label-s',
                                                    margin: 0,
                                                    labelClsExtra: 'label-s',
                                                    name: 'target',
                                                    boxLabel: 'フォルダとファイル',
                                                    checked: true,
                                                    inputValue: 'folder_file'
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    cls: 'label-s',
                                                    margin: 0,
                                                    labelClsExtra: 'label-s',
                                                    name: 'target',
                                                    boxLabel: 'ファイルのみ',
                                                    inputValue: 'file'
                                                },
                                                {
                                                    xtype: 'radiofield',
                                                    cls: 'label-s',
                                                    margin: 0,
                                                    name: 'target',
                                                    boxLabel: 'カレントフォルダのみ',
                                                    inputValue: 'folder'
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'tabpanel',
                                    flex: 1,
                                    margin: '3 0 0 0',
                                    activeTab: 0,
                                    items: [
                                        {
                                            xtype: 'panel',
                                            frame: true,
                                            itemId: 'privilegeSetFolder',
                                            layout: {
                                                align: 'stretch',
                                                type: 'vbox'
                                            },
                                            title: 'アクセス権',
                                            items: [
                                                {
                                                    xtype: 'fieldset',
                                                    height: 50,
                                                    hidden: true,
                                                    id: 'privilege_folder_owner',
                                                    margin: 1,
                                                    padding: '0 10 0 10',
                                                    layout: {
                                                        align: 'stretch',
                                                        type: 'hbox'
                                                    },
                                                    title: 'オーナー',
                                                    items: [
                                                        {
                                                            xtype: 'radiofield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            margin: '0 0 0 0',
                                                            padding: '0 0 0 0',
                                                            name: 'owner_right',
                                                            boxLabel: 'フルアクセス',
                                                            inputValue: 'full'
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            margin: '0 0 0 0',
                                                            padding: '0 0 0 0',
                                                            width: 110,
                                                            name: 'owner_right',
                                                            boxLabel: '読み取り専用',
                                                            inputValue: 'read_only'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    height: 50,
                                                    hidden: true,
                                                    id: 'privilege_folder_other',
                                                    margin: 1,
                                                    padding: '0 10 0 10',
                                                    layout: {
                                                        align: 'stretch',
                                                        type: 'hbox'
                                                    },
                                                    title: '他のユーザ',
                                                    items: [
                                                        {
                                                            xtype: 'checkboxfield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            name: 'other_readable',
                                                            value: false,
                                                            boxLabel: '読み取り',
                                                            inputValue: 'true',
                                                            uncheckedValue: 'false'
                                                        },
                                                        {
                                                            xtype: 'checkboxfield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            name: 'other_writable',
                                                            value: false,
                                                            boxLabel: '書き込み',
                                                            inputValue: 'true',
                                                            uncheckedValue: 'false'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    flex: 1,
                                                    id: 'privilege_folder_group',
                                                    margin: 1,
                                                    layout: {
                                                        align: 'stretch',
                                                        padding: '0 0 12 0',
                                                        type: 'vbox'
                                                    },
                                                    title: '選択したメンバーに対するアクセス権設定',
                                                    items: [
                                                        {
                                                            xtype: 'fieldcontainer',
                                                            height: 25,
                                                            maxHeight: 25,
                                                            width: 400,
                                                            layout: {
                                                                align: 'stretch',
                                                                type: 'hbox'
                                                            },
                                                            items: [
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'group_readable',
                                                                    value: false,
                                                                    boxLabel: '読み取り',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'group_writable',
                                                                    value: false,
                                                                    boxLabel: '書き込み',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'control_right',
                                                                    value: false,
                                                                    boxLabel: 'アクセス権編集',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'gridpanel',
                                                            flex: 1,
                                                            itemId: 'selectedAccessGroupFolder',
                                                            autoScroll: true,
                                                            store: 'GroupFolderStore',
                                                            selModel: Ext.create('Ext.selection.CheckboxModel', {
                                                            }),
                                                            viewConfig:
                                                                    {
                                                                        emptyText: 'データがありません'
                                                                    },
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 120,
                                                                    dataIndex: 'group_name',
                                                                    text: 'グループ名'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 150,
                                                                    dataIndex: 'group_description',
                                                                    text: 'グループ補助名',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 70,
                                                                    dataIndex: 'group_privilege',
                                                                    text: 'アクセス権限'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'group_description',
                                                                    hideable: false,
                                                                    text: 'グループ説明',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'data_class',
                                                                    hideable: false
                                                                }
                                                            ],
                                                            listeners:
                                                                    {
                                                                        beforerender: function ()
                                                                        {
                                                                            var store = Ext.getStore('GroupFolderStore');
                                                                            Ext.apply(store.proxy.extraParams,
                                                                                    {
                                                                                        add_flag: 0
                                                                                    });
                                                                        }
                                                                    },
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'pagingtoolbar',
                                                                    dock: 'bottom',
                                                                    id: 'privilege_folder_bar',
                                                                    displayInfo: true,
                                                                    store: 'GroupFolderStore',
                                                                    listeners:
                                                                            {
                                                                                /*change: function ()
                                                                                 {
                                                                                 console.log('test');
                                                                                 var store=Ext.getStore('GroupFolderStore');
                                                                                 Ext.apply(store.proxy.extraParams,
                                                                                 {
                                                                                 add_flag: 1
                                                                                 });
                                                                                 }*/
                                                                            }
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'toolbar',
                                                            height: 33,
                                                            margin: '0 0 1 0',
                                                            ui: 'footer',
                                                            items: [
                                                                {
                                                                    xtype: 'button',
                                                                    handler: function (button, event) {
                                                                        if (Busy === true) {
                                                                            return;
                                                                        }
                                                                        Busy = true;

                                                                        var thisForm = Ext.ComponentQuery.query('#folderPrivilege')[0].getForm().getFieldValues();

                                                                        if (thisForm.text === '') {
                                                                            Busy = false;
                                                                            Ext.Msg.show({
                                                                                title: 'フォルダ選択',
                                                                                msg: 'フォルダを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        var thisGrid = Ext.ComponentQuery.query('#selectedAccessGroupFolder')[0];

                                                                        var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                        if (Ext.isEmpty(records)) {
                                                                            Busy = false;
                                                                            Ext.Msg.show({
                                                                                title: 'グループ選択',
                                                                                msg: 'グループを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        for (var i = 0; i < records.length; i++) {
                                                                            data.push(records[i].data);
                                                                        }

                                                                        var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                        dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                        var dataZ = Ext.apply({request_type: "dismiss_folder_group"}, dataY);

                                                                        var target = Ext.getCmp('opend_by').value;
                                                                        dataZ = Ext.apply({target: target}, dataZ);

                                                                        Ext.Ajax.request({
                                                                            url: 'tdx/updatedata.tdx',
                                                                            //url: 'php/updatedata.php',
                                                                            jsonData: dataZ,
                                                                            success: handleSuccess,
                                                                            failure: handleFailure
                                                                        });

                                                                        function handleSuccess(response) {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;
                                                                            Busy = false;
                                                                            if (request_success === false) {
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show({
                                                                                    title: 'グループ除外失敗',
                                                                                    msg: request_errors,
                                                                                    buttons: Ext.Msg.OK
                                                                                });
                                                                            } else {
                                                                                //Ext.Msg.hide();
                                                                                requestRefresh3();
                                                                            }
                                                                            return;
                                                                        }

                                                                        function handleFailure(response) {
                                                                            Busy = false;
                                                                            Ext.Msg.show({
                                                                                title: 'グループ除外失敗',
                                                                                msg: 'サーバとの通信に失敗しました',
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                        }

                                                                        function requestRefresh3() {
                                                                            sending_cont_location = "";
                                                                            sending_hash_key = "THIS_WAS_CALLED_FROM_PRIVILEDGE_EXCLUDE";

                                                                            var requestRefreshData = Ext.apply({session_id: this_session_id}, {cont_location: sending_cont_location});
                                                                            requestRefreshData = Ext.apply(requestRefreshData, {hash_key: sending_hash_key});
                                                                            requestRefreshData = Ext.apply({event_type: "priviledge_folder_member_exclude"}, requestRefreshData);
                                                                            requestRefreshData = Ext.apply({request_type: "update_folder_list"}, requestRefreshData);

                                                                            Ext.Ajax.request({
                                                                                url: 'tdx/updatedata.tdx',
                                                                                jsonData: requestRefreshData,
                                                                                success: handleSuccess2,
                                                                                failure: handleFailure2
                                                                            });

                                                                        }

                                                                        function handleSuccess2(response) {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;
                                                                            var request_status = obj.status;

                                                                            if (request_success === false) {
                                                                                Busy = false;
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show({
                                                                                    title: 'グループ除外失敗',
                                                                                    msg: request_errors,
                                                                                    buttons: Ext.Msg.OK
                                                                                });
                                                                            } else {
                                                                                Ext.getStore('FolderDataStoreA').load();
                                                                                Ext.getStore('FolderDataStoreB').load();

                                                                                Ext.getCmp('privilege_folder_bar').moveFirst();
                                                                                Busy = false;
                                                                            }
                                                                        }

                                                                        function handleFailure2(response) {
                                                                            Busy = false;
                                                                            Ext.Msg.show({
                                                                                title: 'グループ除外失敗',
                                                                                msg: 'サーバとの通信に失敗しました',
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                        }
                                                                    },
                                                                    id: 'btn_folder_exclude',
                                                                    allowDepress: false,
                                                                    icon: 'data/small_icon/delete.png',
                                                                    text: 'メンバーの除外',
                                                                    tooltip: {
                                                                        html: '選択したグループをこのフォルダに対するアクセス権設定グループから除外します。'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldcontainer',
                                                    height: 30,
                                                    margin: '0 1 0 1',
                                                    maxHeight: 30,
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function (button, event) {
                                                                if (Busy === true) {
                                                                    return;
                                                                }
                                                                Busy = true;

                                                                var thisForm = Ext.ComponentQuery.query('#folderPrivilege')[0].getForm().getFieldValues();

                                                                if (thisForm.text === '') {
                                                                    Busy = false;
                                                                    Ext.Msg.show({
                                                                        title: 'フォルダ選択',
                                                                        msg: 'フォルダを選択してください',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                var thisGrid = Ext.ComponentQuery.query('#selectedAccessGroupFolder')[0];

                                                                var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                //console.log(thisForm);

                                                                /*
                                                                 if (Ext.isEmpty(records)) {
                                                                 Ext.Msg.show({
                                                                 title:'グループ選択',
                                                                 msg: 'グループを選択して下さい。',
                                                                 icon: Ext.Msg.ERROR,
                                                                 buttons: Ext.Msg.OK
                                                                 });
                                                                 return;
                                                                 }
                                                                 */

                                                                for (var i = 0; i < records.length; i++) {
                                                                    data.push(records[i].data);
                                                                }

                                                                var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                var request_type_field = Ext.getCmp('PrivilegeDsp_request_type');
                                                                var dataZ = Ext.apply({request_type: request_type_field.value}, dataY);
                                                                Ext.Ajax.request({
                                                                    url: 'tdx/updatedata.tdx',
                                                                    method: 'POST',
                                                                    jsonData: dataZ,
                                                                    success: handleSuccess,
                                                                    failure: handleFailure
                                                                });

                                                                function handleSuccess(response) {
                                                                    obj = Ext.decode(response.responseText);
                                                                    var request_success = obj.success;

                                                                    if (request_success === false) {
                                                                        Busy = false;
                                                                        var request_errors = obj.errors;
                                                                        Ext.Msg.show({
                                                                            title: 'アクセス権設定失敗',
                                                                            msg: request_errors,
                                                                            buttons: Ext.Msg.OK
                                                                        });
                                                                    } else {
                                                                        //if (thisForm.cont_location === 'folder_a') {
                                                                        //Ext.getStore('FolderDataStoreA').load();
                                                                        //} else if (thisForm.cont_location === 'folder_b') {
                                                                        //Ext.getStore('FolderDataStoreB').load();
                                                                        //}

                                                                        Ext.getCmp('privilege_folder_bar').moveFirst();
                                                                        Busy = false;
                                                                    }
                                                                    return;
                                                                }

                                                                function handleFailure(response) {
                                                                    Busy = false;
                                                                    Ext.Msg.show({
                                                                        title: 'アクセス権設定失敗',
                                                                        msg: 'サーバとの通信に失敗しました',
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                }

                                                            },
                                                            id: 'btn_folder_access',
                                                            margin: '5 0 0 0',
                                                            icon: 'data/small_icon/checkout.png',
                                                            text: 'アクセス権設定',
                                                            tooltip: {
                                                                html: 'このフォルダに対するアクセス権を設定します。'
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            frame: true,
                                            hidden: false,
                                            itemId: 'notificationSetFolder',
                                            layout: {
                                                align: 'stretch',
                                                type: 'vbox'
                                            },
                                            title: '更新通知',
                                            items: [
                                                {
                                                    xtype: 'fieldset',
                                                    flex: 1,
                                                    id: 'notification_folder_group',
                                                    margin: 1,
                                                    layout: {
                                                        align: 'stretch',
                                                        padding: '0 0 12 0',
                                                        type: 'vbox'
                                                    },
                                                    title: '選択したグループに対する通知タイミング',
                                                    items: [
                                                        {
                                                            xtype: 'fieldcontainer',
                                                            height: 25,
                                                            maxHeight: 25,
                                                            width: 400,
                                                            layout: {
                                                                align: 'stretch',
                                                                type: 'hbox'
                                                            },
                                                            items: [
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_read',
                                                                    value: false,
                                                                    boxLabel: 'アップロード',
//																	boxLabel: '読み込み',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_modify',
                                                                    value: false,
                                                                    boxLabel: '更新',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_delete',
                                                                    value: false,
                                                                    boxLabel: '削除',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'gridpanel',
                                                            flex: 1,
                                                            itemId: 'selectedNotificationGroupFolder',
                                                            autoScroll: true,
                                                            store: 'GroupFolderStore',
                                                            selModel: Ext.create('Ext.selection.CheckboxModel', {
                                                            }),
                                                            viewConfig:
                                                                    {
                                                                        emptyText: 'データがありません'
                                                                    },
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 120,
                                                                    dataIndex: 'group_name',
                                                                    text: 'グループ名'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 150,
                                                                    dataIndex: 'group_description',
                                                                    text: 'グループ補助名',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 80,
                                                                    dataIndex: 'group_notification',
                                                                    text: '更新通知設定'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'group_description',
                                                                    hideable: false,
                                                                    text: 'グループ説明',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'data_class',
                                                                    hideable: false
                                                                }
                                                            ],
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'pagingtoolbar',
                                                                    dock: 'bottom',
                                                                    id: 'notification_folder_bar',
                                                                    displayInfo: true,
                                                                    store: 'GroupFolderStore'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'toolbar',
                                                            height: 33,
                                                            margin: '0 0 1 0',
                                                            ui: 'footer',
                                                            items: [
                                                                {
                                                                    xtype: 'button',
                                                                    handler: function (button, event) {
                                                                        var thisForm = Ext.ComponentQuery.query('#folderPrivilege')[0].getForm().getFieldValues();

                                                                        if (thisForm.text === '') {
                                                                            Ext.Msg.show({
                                                                                title: 'フォルダ選択',
                                                                                msg: 'フォルダを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        var thisGrid = Ext.ComponentQuery.query('#selectedNotificationGroupFolder')[0];

                                                                        var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                        if (Ext.isEmpty(records)) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ選択',
                                                                                msg: 'グループを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        for (var i = 0; i < records.length; i++) {
                                                                            data.push(records[i].data);
                                                                        }

                                                                        var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                        dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                        var dataZ = Ext.apply({request_type: "dismiss_folder_group"}, dataY);

                                                                        Ext.Ajax.request({
                                                                            url: 'tdx/updatedata.tdx',
                                                                            method: 'POST',
                                                                            jsonData: dataZ,
                                                                            success: handleSuccess,
                                                                            failure: handleFailure
                                                                        });

                                                                        function handleSuccess(response) {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;

                                                                            if (request_success === false) {
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show({
                                                                                    title: 'グループ除外失敗',
                                                                                    msg: request_errors,
                                                                                    buttons: Ext.Msg.OK
                                                                                });
                                                                            } else {
                                                                                Ext.getCmp('notification_folder_bar').moveFirst();
                                                                            }
                                                                            return;
                                                                        }

                                                                        function handleFailure(response) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ除外失敗',
                                                                                msg: 'サーバとの通信に失敗しました',
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                        }

                                                                    },
                                                                    id: 'btn_folder_exclude1',
                                                                    allowDepress: false,
                                                                    icon: 'data/small_icon/delete.png',
                                                                    text: 'グループの除外',
                                                                    tooltip: {
                                                                        html: '選択したグループをこのフォルダに対するアクセス権設定グループから除外します。'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldcontainer',
                                                    height: 30,
                                                    margin: '0 1 0 1',
                                                    maxHeight: 30,
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function (button, event) {
                                                                var thisForm = Ext.ComponentQuery.query('#folderPrivilege')[0].getForm().getFieldValues();

                                                                if (thisForm.text === '') {
                                                                    Ext.Msg.show({
                                                                        title: 'フォルダ選択',
                                                                        msg: 'フォルダを選択してください',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                var thisGrid = Ext.ComponentQuery.query('#selectedNotificationGroupFolder')[0];

                                                                var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                if (Ext.isEmpty(records)) {
                                                                    Ext.Msg.show({
                                                                        title: 'グループ選択',
                                                                        msg: 'グループを選択してください',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                for (var i = 0; i < records.length; i++) {
                                                                    data.push(records[i].data);
                                                                }

                                                                var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                var dataZ = Ext.apply({request_type: "set_folder_notification"}, dataY);

                                                                Ext.Ajax.request({
                                                                    url: 'tdx/updatedata.tdx',
                                                                    method: 'POST',
                                                                    jsonData: dataZ,
                                                                    success: handleSuccess,
                                                                    failure: handleFailure
                                                                });

                                                                function handleSuccess(response) {
                                                                    obj = Ext.decode(response.responseText);
                                                                    var request_success = obj.success;

                                                                    if (request_success === false) {
                                                                        var request_errors = obj.errors;
                                                                        Ext.Msg.show({
                                                                            title: '更新通知設定失敗',
                                                                            msg: request_errors,
                                                                            buttons: Ext.Msg.OK
                                                                        });
                                                                    } else {
                                                                        if (thisForm.cont_location === 'folder_a') {
                                                                            Ext.getStore('FolderDataStoreA').load();
                                                                        } else if (thisForm.cont_location === 'folder_b') {
                                                                            Ext.getStore('FolderDataStoreB').load();
                                                                        }
                                                                        Ext.getCmp('notification_folder_bar').moveFirst();
                                                                    }
                                                                    return;
                                                                }

                                                                function handleFailure(response) {
                                                                    Ext.Msg.show({
                                                                        title: '更新通知設定失敗',
                                                                        msg: 'サーバとの通信に失敗しました',
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                }

                                                            },
                                                            id: 'btn_folder_access1',
                                                            margin: '5 0 0 0',
                                                            icon: 'data/small_icon/checkout.png',
                                                            text: '更新通知設定',
                                                            tooltip: {
                                                                html: 'このフォルダに対するアクセス権を設定します。'
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            flex: 0.8,
                            frame: true,
                            id: 'searchGroupFolder',
                            autoScroll: true,
                            layout: {
                                align: 'stretch',
                                padding: 0,
                                type: 'vbox'
                            },
                            bodyPadding: 5,
                            items: [
                                {
                                    xtype: 'fieldset',
                                    id: 'privilege_folder_search',
                                    margin: '0 0 0 0',
                                    title: 'メンバーを検索',
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            margin: 0,
                                            fieldLabel: '検索グループ名',
                                            name: 'searching_group',
                                            validateOnChange: false,
                                            validateOnBlur: false,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'target_hash_key'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function (button, event) {

                                                if (Busy === true) {
                                                    return;
                                                }
                                                Busy = true;

                                                var formX = this.up('form').getForm().getFieldValues();

                                                if (formX.searching_group === '') {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        title: '検索グループ名入力',
                                                        msg: '検索グループ名を入力してください',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                if (formX.searching_group.trim().length < 1)
                                                {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        //title:'新規グループ名・説明入力',
                                                        //msg: '新規グループ名/説明を入力して下さい。',
                                                        title: '検索グループ名入力',
                                                        msg: '半角、全角スペースのみは許可されません。',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                store = Ext.getStore('MemberTreeStore');
                                                field_data = Ext.getCmp('searching_group');
                                                Ext.apply(store.proxy.extraParams,
                                                        {
                                                            group_name: formX.searching_group
                                                        });
                                                store.load({callback: function (rec, opt, success)
                                                    {
                                                        Busy = false;
                                                    }
                                                });

                                                //var dataY = Ext.apply({session_id: this_session_id}, formX);
                                                //dataY = Ext.apply({request_type: "search_group_folder_privilege"}, dataY);

                                                /*Ext.Ajax.request({
                                                 url: 'tdx/updatedata.tdx',
                                                 method: 'POST',
                                                 jsonData: dataY,
                                                 success: handleSuccess,
                                                 failure: handleFailure
                                                 });*/

                                                Ext.Msg.show({
                                                    title: 'グループ検索中',
                                                    msg: 'グループ検索中です'
                                                });

                                                /*function handleSuccess(response) {
                                                 obj = Ext.decode(response.responseText);
                                                 var request_success = obj.success;
                                                 
                                                 if (request_success === false) {
                                                 Busy = false;
                                                 var request_errors = obj.errors;
                                                 Ext.Msg.hide();
                                                 Ext.Msg.show({
                                                 title:'グループ検索失敗',
                                                 msg: request_errors,
                                                 buttons: Ext.Msg.OK
                                                 });
                                                 } else {
                                                 Ext.Msg.hide();
                                                 Ext.getCmp('searched_group_folder_bar').moveFirst();
                                                 Busy = false;
                                                 }
                                                 return;
                                                 }
                                                 
                                                 function handleFailure(response) {
                                                 Busy = false;
                                                 Ext.Msg.hide();
                                                 Ext.Msg.show({
                                                 title:'グループ検索失敗',
                                                 msg: 'サーバとの通信に失敗しました',
                                                 buttons: Ext.Msg.OK
                                                 });
                                                 }*/

                                            },
                                            margin: '-39 0 0 270',
                                            width: 100,
                                            text: '検索 ',
                                            tooltip: {
                                                html: '指定した条件によって、グループを検索します。'
                                            }
                                        }
                                    ]
                                },
                                {
                                    xtype: 'treepanel',
                                    flex: 1,
                                    itemId: 'groupList',
                                    id: 'allGroupMembersFolder',
                                    padding: '0 0 0 0',
                                    store: 'MemberTreeStore',
                                    rootVisible: false,
                                    useArrows: true,
                                    viewConfig:
                                            {
                                                emptyText: 'データがありません'
                                            },
                                    listeners:
                                            {
                                                checkchange: function (node, checked, options)
                                                {
                                                    if (!node.isLeaf())
                                                    {
                                                        var cn = node.childNodes;
                                                        var len = cn.length;
                                                        if (len > 0)
                                                        {
                                                            if (checked)
                                                            {
                                                                for (var i = 0; i < len; i++)
                                                                {
                                                                    cn[i].data.checked = true;
                                                                }
                                                                node.collapse();
                                                                node.expand();
                                                            } else
                                                            {
                                                                for (var i = 0; i < len; i++)
                                                                {
                                                                    cn[i].data.checked = false;
                                                                }
                                                                node.collapse();
                                                                //node.expand();
                                                            }
                                                        }
                                                    } else
                                                    {
                                                        var count = 0;
                                                        var len = node.parentNode.childNodes.length;
                                                        var p_node = node.parentNode;
                                                        for (var i = 0; i < len; i++)
                                                        {
                                                            if (p_node.childNodes[i].data.checked)
                                                            {
                                                                count++;
                                                            }
                                                        }
                                                        if (count >= len)
                                                        {
                                                            p_node.data.checked = true;
                                                            p_node.collapse();
                                                            p_node.expand();
                                                        } else
                                                        {
                                                            p_node.data.checked = false;
                                                        }
                                                        //p_node.collapse();
                                                        //p_node.expand();
                                                    }
                                                }
                                            },
                                    dockedItems:
                                            [
                                                {
                                                    xtype: 'toolbar',
                                                    dock: 'bottom',
                                                    items:
                                                            [
                                                                {
                                                                    xtype: 'button',
                                                                    width: 100,
                                                                    icon: 'data/small_icon/add.png',
                                                                    text: 'メンバー追加',
                                                                    tooltip:
                                                                            {
                                                                                html: '選択したグループ、メンバーを左のグループのメンバーとして追加します。'
                                                                            },
                                                                    handler: function (button, event)
                                                                    {
                                                                        if (Busy === true) {
                                                                            return;
                                                                        }
                                                                        Busy = true;
                                                                        //var componentG = Ext.getCmp('wholeGroups');
                                                                        //var gridG = componentG.down('#groupList');
                                                                        //var records = gridG.getSelectionModel().getSelection(), data = [];
                                                                        var data = [];
                                                                        var records = Ext.getCmp('allGroupMembersFolder').getChecked();

                                                                        if (Ext.isEmpty(records))
                                                                        {
                                                                            Busy = false;
                                                                            Ext.Msg.show(
                                                                                    {
                                                                                        title: 'メンバー選択',
                                                                                        msg: 'メンバーを選択してください',
                                                                                        icon: Ext.Msg.ERROR,
                                                                                        buttons: Ext.Msg.OK
                                                                                    });
                                                                            return;
                                                                        }

                                                                        var i = 0;
                                                                        while (i < records.length)
                                                                        {
                                                                            data.push(records[i].raw);
                                                                            if (!records[i].isLeaf())
                                                                            {
                                                                                i += (records[i].childNodes.length + 1);
                                                                            } else
                                                                            {
                                                                                i += 1;
                                                                            }
                                                                        }
                                                                        //var send_data = [];
                                                                        var formX = this.up('form').getForm().getFieldValues();
                                                                        /*var index = 0;
                                                                         for (var i = 0; i < data.length; i++)
                                                                         {
                                                                         if (data[i]["leaf"] === true)
                                                                         {
                                                                         send_data[index] = data[i];
                                                                         index++;
                                                                         }
                                                                         }*/
                                                                        console.log(formX);
                                                                        var dataY = Ext.apply(formX, data);
                                                                        dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                        var dataZ = Ext.apply({request_type: "append_my_folder_members"}, dataY);
                                                                        var hash_key = Ext.getCmp('folderPrivilege').getForm().getFieldValues().hash_key;
                                                                        dataZ = Ext.apply({hash_key: hash_key}, dataZ);
                                                                        var target = Ext.getCmp('opend_by').value;
                                                                        dataZ = Ext.apply({target: target}, dataZ);
                                                                        Ext.Ajax.request(
                                                                                {
                                                                                    url: 'tdx/updatedata.tdx',
                                                                                    jsonData: dataZ,
                                                                                    success: handleSuccess,
                                                                                    failure: handleFailure
                                                                                });

                                                                        function handleSuccess(response)
                                                                        {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;
                                                                            if (request_success === false)
                                                                            {
                                                                                Busy = false;
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show(
                                                                                        {
                                                                                            title: 'メンバー追加失敗',
                                                                                            msg: request_errors,
                                                                                            buttons: Ext.Msg.OK
                                                                                        });
                                                                            } else
                                                                            {
                                                                                //Ext.getCmp('my_group_bar').moveFirst();
                                                                                //Ext.getCmp('group_all_bar').moveFirst();
                                                                                store = Ext.getStore('GroupFolderStore');
                                                                                Ext.apply(store.proxy.extraParams,
                                                                                        {
                                                                                            add_flag: 1
                                                                                        });
                                                                                Ext.getCmp('privilege_folder_bar').moveFirst();
                                                                                Busy = false;
                                                                            }
                                                                            return;
                                                                        }

                                                                        function handleFailure(response)
                                                                        {
                                                                            Busy = false;
                                                                            Ext.Msg.show(
                                                                                    {
                                                                                        title: 'メンバー追加失敗',
                                                                                        msg: 'サーバとの通信に失敗しました',
                                                                                        buttons: Ext.Msg.OK
                                                                                    });
                                                                        }
                                                                    }
                                                                }
                                                            ]
                                                }
                                            ]
                                }
                                /*{
                                 xtype: 'gridpanel',
                                 flex: 1,
                                 id: 'allGroupMembersFolder',
                                 itemId: '',
                                 margin: '5 0 0 0',
                                 padding: '0 0 0 0',
                                 autoScroll: true,
                                 store: 'GroupAllStore',
                                 viewConfig: {
                                 frame: true,
                                 emptyText: 'データがありません'
                                 },
                                 selModel: Ext.create('Ext.selection.CheckboxModel', {
                                 
                                 }),
                                 columns: [
                                 {
                                 xtype: 'gridcolumn',
                                 width: 140,
                                 dataIndex: 'group_name',
                                 text: 'メンバー名'
                                 },
                                 {
                                 xtype: 'gridcolumn',
                                 width: 80,
                                 dataIndex: 'member_name',
                                 text: '',
                                 flex: 1
                                 },
                                 {
                                 xtype: 'gridcolumn',
                                 hidden: true,
                                 minWidth: 120,
                                 dataIndex: 'group_description',
                                 hideable: false,
                                 text: 'グループ説明',
                                 flex: 1
                                 },
                                 {
                                 xtype: 'gridcolumn',
                                 hidden: true,
                                 dataIndex: 'member_description',
                                 hideable: false,
                                 text: 'メンバー補助名',
                                 flex: 1
                                 },
                                 {
                                 xtype: 'gridcolumn',
                                 hidden: true,
                                 width: 100,
                                 dataIndex: 'member_id',
                                 hideable: false,
                                 text: 'メンバーID'
                                 }
                                 ],
                                 features: [
                                 {
                                 ftype: 'grouping',
                                 enableGroupingMenu: false,
                                 groupHeaderTpl: '{name}',
                                 startCollapsed: true
                                 }
                                 ],
                                 dockedItems: [
                                 {
                                 xtype: 'pagingtoolbar',
                                 dock: 'bottom',
                                 id: 'searched_group_folder_bar',
                                 displayInfo: true,
                                 store: 'GroupAllStore'
                                 }
                                 ]
                                 },
                                 {
                                 xtype: 'fieldcontainer',
                                 flex: 1,
                                 height: 30,
                                 margin: '0 0 0 0',
                                 maxHeight: 30,
                                 width: 400,
                                 items: [
                                 {
                                 xtype: 'button',
                                 handler: function(button, event) {
                                 if (Busy === true) {return;}
                                 Busy = true;
                                 
                                 var formX = this.up('form').getForm().getFieldValues();
                                 
                                 var componentM = Ext.getCmp('searchGroupFolder');
                                 var grid = componentM.down('#allGroupMembersFolder');
                                 
                                 var records = grid.getSelectionModel().getSelection(), data = [];
                                 
                                 if (Ext.isEmpty(records)) {
                                 Busy = false;
                                 Ext.Msg.show({
                                 title:'メンバー・グループ選択',
                                 msg: 'メンバー・グループを選択してください',
                                 icon: Ext.Msg.ERROR,
                                 buttons: Ext.Msg.OK
                                 });
                                 return;
                                 }
                                 
                                 for (var i = 0; i < records.length; i++) {
                                 data.push(records[i].data);
                                 }
                                 
                                 var dataY = Ext.apply(formX, data);
                                 dataY = Ext.apply({session_id: this_session_id}, dataY);
                                 var dataZ = Ext.apply({request_type: "append_my_folder_members"},dataY);
                                 
                                 Ext.Ajax.request({
                                 url: 'tdx/updatedata.tdx',
                                 jsonData: dataZ,
                                 method: 'POST',
                                 success: handleSuccess,
                                 failure: handleFailure
                                 });
                                 
                                 function handleSuccess(response) {
                                 obj = Ext.decode(response.responseText);
                                 var request_success = obj.success;
                                 
                                 if (request_success === false) {
                                 Busy = false;
                                 var request_errors = obj.errors;
                                 Ext.Msg.show({
                                 title:'メンバー・グループ追加失敗',
                                 msg: request_errors,
                                 buttons: Ext.Msg.OK
                                 });
                                 } else {
                                 console.log('test2');
                                 Ext.getCmp('privilege_folder_bar').moveFirst();
                                 //Ext.getCmp('notification_folder_bar').moveFirst();
                                 Busy = false;
                                 }
                                 return;
                                 }
                                 
                                 function handleFailure(response) {
                                 Busy = false;
                                 Ext.Msg.show({
                                 title:'メンバー・グループ追加失敗',
                                 msg: 'サーバとの通信に失敗しました',
                                 buttons: Ext.Msg.OK
                                 });
                                 }
                                 },
                                 id: 'btn_add_member_folder',
                                 margin: '5 0 0 0',
                                 icon: 'data/small_icon/add.png',
                                 text: 'メンバー追加',
                                 tooltip: {
                                 html: '選択したグループ、メンバーをこのフォルダのアクセス権設定グループとして追加します。'
                                 }
                                 }
                                 ]
                                 }*/
                            ]
                        }
                    ]
                },
                {
                    xtype: 'panel',
                    hidden: true,
                    id: 'fileAccess',
                    layout: {
                        align: 'stretch',
                        type: 'hbox'
                    },
                    title: 'ファイルのアクセス権',
                    tabConfig: {
                        xtype: 'tab',
                        flex: 1,
                        autoWidth: true,
                        listeners: {
                            click: {
                                fn: me.onTabClick,
                                scope: me
                            }
                        }
                    },
                    items: [
                        {
                            xtype: 'form',
                            flex: 1,
                            frame: true,
                            id: 'filePrivilege',
                            layout: {
                                align: 'stretch',
                                type: 'vbox'
                            },
                            bodyPadding: 5,
                            items: [
                                {
                                    xtype: 'fieldset',
                                    height: 50,
                                    margin: 0,
                                    layout: {
                                        align: 'stretch',
                                        type: 'hbox'
                                    },
                                    title: 'このファイルのアクセス権を設定します。',
                                    items: [
                                        {
                                            xtype: 'displayfield',
                                            flex: 1,
                                            height: 20,
                                            padding: 0,
                                            name: 'file_name'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            flex: 1,
                                            height: 20,
                                            padding: 0,
                                            fieldLabel: '所有者',
                                            name: 'owner_name'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'tabpanel',
                                    flex: 1,
                                    margin: '3 0 0 0',
                                    activeTab: 0,
                                    items: [
                                        {
                                            xtype: 'panel',
                                            frame: true,
                                            itemId: 'privilegeSetFile',
                                            layout: {
                                                align: 'stretch',
                                                type: 'vbox'
                                            },
                                            title: 'アクセス権',
                                            items: [
                                                {
                                                    xtype: 'fieldset',
                                                    height: 50,
                                                    hidden: true,
                                                    id: 'privilege_file_owner',
                                                    margin: 1,
                                                    padding: '0 10 0 10',
                                                    layout: {
                                                        align: 'stretch',
                                                        type: 'hbox'
                                                    },
                                                    title: 'オーナー',
                                                    items: [
                                                        {
                                                            xtype: 'radiofield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            margin: '0 0 0 0',
                                                            padding: '0 0 0 0',
                                                            name: 'owner_right',
                                                            boxLabel: 'フルアクセス',
                                                            inputValue: 'full'
                                                        },
                                                        {
                                                            xtype: 'radiofield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            margin: '0 0 0 0',
                                                            padding: '0 0 0 0',
                                                            width: 110,
                                                            name: 'owner_right',
                                                            boxLabel: '読み取り専用',
                                                            inputValue: 'read_only'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    height: 50,
                                                    hidden: true,
                                                    id: 'privilege_file_other',
                                                    margin: 1,
                                                    padding: '0 10 0 10',
                                                    layout: {
                                                        align: 'stretch',
                                                        type: 'hbox'
                                                    },
                                                    title: '他のユーザ',
                                                    items: [
                                                        {
                                                            xtype: 'checkboxfield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            name: 'other_readable',
                                                            value: false,
                                                            boxLabel: '読み取り',
                                                            inputValue: 'true',
                                                            uncheckedValue: 'false'
                                                        },
                                                        {
                                                            xtype: 'checkboxfield',
                                                            flex: 1,
                                                            cls: 'label-s',
                                                            name: 'other_writable',
                                                            value: false,
                                                            boxLabel: '書き込み',
                                                            inputValue: 'true',
                                                            uncheckedValue: 'false'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    flex: 1,
                                                    id: 'privilege_file_group',
                                                    margin: 1,
                                                    layout: {
                                                        align: 'stretch',
                                                        padding: '0 0 12 0',
                                                        type: 'vbox'
                                                    },
                                                    title: '選択したグループ',
                                                    items: [
                                                        {
                                                            xtype: 'fieldcontainer',
                                                            height: 25,
                                                            maxHeight: 25,
                                                            width: 400,
                                                            layout: {
                                                                align: 'stretch',
                                                                type: 'hbox'
                                                            },
                                                            items: [
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'group_readable',
                                                                    value: false,
                                                                    boxLabel: '読み取り',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'group_writable',
                                                                    value: false,
                                                                    boxLabel: '書き込み',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'control_right',
                                                                    value: false,
                                                                    boxLabel: 'アクセス権編集',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'gridpanel',
                                                            flex: 1,
                                                            itemId: 'selectedAccessGroupFile',
                                                            autoScroll: true,
                                                            store: 'GroupFileStore',
                                                            selModel: Ext.create('Ext.selection.CheckboxModel', {
                                                            }),
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 120,
                                                                    dataIndex: 'group_name',
                                                                    text: 'グループ名'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 150,
                                                                    dataIndex: 'member_name',
                                                                    text: 'メンバー名',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 70,
                                                                    dataIndex: 'group_privilege',
                                                                    text: 'アクセス権限'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'group_description',
                                                                    hideable: false,
                                                                    text: 'グループ説明',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'data_class',
                                                                    hideable: false
                                                                }
                                                            ],
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'pagingtoolbar',
                                                                    dock: 'bottom',
                                                                    id: 'privilege_file_bar',
                                                                    width: 360,
                                                                    displayInfo: true,
                                                                    store: 'GroupFileStore'
                                                                }
                                                            ],
                                                            viewConfig: {
                                                                emptyText: 'データがありません'
                                                            }
                                                        },
                                                        {
                                                            xtype: 'toolbar',
                                                            height: 33,
                                                            margin: '0 0 1 0',
                                                            ui: 'footer',
                                                            items: [
                                                                {
                                                                    xtype: 'button',
                                                                    handler: function (button, event) {
                                                                        var thisForm = Ext.ComponentQuery.query('#filePrivilege')[0].getForm().getFieldValues();

                                                                        if (thisForm.text === '') {
                                                                            Ext.Msg.show({
                                                                                title: 'フォルダ選択',
                                                                                msg: 'フォルダを選択して下さい。',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        var thisGrid = Ext.ComponentQuery.query('#selectedAccessGroupFile')[0];

                                                                        var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                        if (Ext.isEmpty(records)) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ選択',
                                                                                msg: 'グループを選択して下さい。',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        for (var i = 0; i < records.length; i++) {
                                                                            data.push(records[i].data);
                                                                        }

                                                                        var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                        dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                        var dataZ = Ext.apply({request_type: "dismiss_file_group"}, dataY);

                                                                        Ext.Ajax.request({
                                                                            url: 'tdx/updatedata.tdx',
                                                                            //url: 'php/updatedata.php',
                                                                            jsonData: dataZ,
                                                                            success: handleSuccess,
                                                                            failure: handleFailure
                                                                        });

                                                                        function handleSuccess(response) {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;

                                                                            if (request_success === false) {
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show({
                                                                                    title: 'グループ除外失敗',
                                                                                    msg: request_errors,
                                                                                    buttons: Ext.Msg.OK
                                                                                });
                                                                            } else {
                                                                                Ext.getCmp('privilege_file_bar').moveFirst();
                                                                            }
                                                                            return;
                                                                        }

                                                                        function handleFailure(response) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ除外失敗',
                                                                                msg: 'サーバとの通信に失敗しました。',
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                        }
                                                                    },
                                                                    id: 'btn_file_exclude',
                                                                    margin: 0,
                                                                    width: 110,
                                                                    icon: 'data/small_icon/delete.png',
                                                                    text: 'グループの除外',
                                                                    tooltip: {
                                                                        html: '選択したグループをこのフファイルに対するアクセス権設定グループから除外します。'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldcontainer',
                                                    height: 30,
                                                    margin: '0 1 0 1',
                                                    maxHeight: 30,
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function (button, event) {
                                                                var thisForm = Ext.ComponentQuery.query('#filePrivilege')[0].getForm().getFieldValues();

                                                                if (thisForm.file_name === '') {
                                                                    Ext.Msg.show({
                                                                        title: 'ファイル選択',
                                                                        msg: 'フファイルを選択して下さい。',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                if (thisForm.group_readable === false && thisForm.group_writable === true) {
                                                                    Ext.Msg.show({
                                                                        title: '設定内容不正',
                                                                        msg: 'チェックした条件での設定はできません。',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                var thisGrid = Ext.ComponentQuery.query('#selectedAccessGroupFile')[0];

                                                                var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                if (Ext.isEmpty(records)) {
                                                                    Ext.Msg.show({
                                                                        title: 'グループ選択',
                                                                        msg: 'グループを選択して下さい。',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                for (var i = 0; i < records.length; i++) {
                                                                    data.push(records[i].data);
                                                                }

                                                                var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                var dataZ = Ext.apply({request_type: "set_file_privilege"}, dataY);
                                                                Ext.Ajax.request({
                                                                    url: 'tdx/updatedata.tdx',
                                                                    method: 'POST',
                                                                    jsonData: dataZ,
                                                                    success: handleSuccess,
                                                                    failure: handleFailure
                                                                });

                                                                function handleSuccess(response) {
                                                                    obj = Ext.decode(response.responseText);
                                                                    var request_success = obj.success;

                                                                    if (request_success === false) {
                                                                        var request_errors = obj.errors;
                                                                        Ext.Msg.show({
                                                                            title: 'アクセス権設定失敗',
                                                                            msg: request_errors,
                                                                            buttons: Ext.Msg.OK
                                                                        });
                                                                        return;
                                                                    } else {
                                                                        if (thisForm.cont_location === 'folder_a') {
                                                                            Ext.getStore('FileDataStoreA').load();
                                                                        } else if (thisForm.cont_location === 'folder_b') {
                                                                            Ext.getStore('FileDataStoreB').load();
                                                                        }
                                                                        Ext.getCmp('privilege_file_bar').moveFirst();
                                                                    }
                                                                    return;
                                                                }

                                                                function handleFailure(response) {
                                                                    Ext.Msg.show({
                                                                        title: 'アクセス権設定失敗',
                                                                        msg: 'サーバとの通信に失敗しました。',
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                            },
                                                            id: 'btn_file_access',
                                                            margin: '5 0 0 0',
                                                            icon: 'data/small_icon/checkout.png',
                                                            text: 'アクセス権設定',
                                                            tooltip: {
                                                                html: 'このファイルに対するアクセス権を設定します。'
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            frame: true,
                                            hidden: true,
                                            itemId: 'notificationSetFile',
                                            layout: {
                                                align: 'stretch',
                                                type: 'vbox'
                                            },
                                            title: '更新通知',
                                            items: [
                                                {
                                                    xtype: 'fieldset',
                                                    flex: 1,
                                                    id: 'notification_file_group',
                                                    margin: 1,
                                                    layout: {
                                                        align: 'stretch',
                                                        padding: '0 0 12 0',
                                                        type: 'vbox'
                                                    },
                                                    title: '選択したグループ',
                                                    items: [
                                                        {
                                                            xtype: 'fieldcontainer',
                                                            height: 25,
                                                            maxHeight: 25,
                                                            width: 400,
                                                            layout: {
                                                                align: 'stretch',
                                                                type: 'hbox'
                                                            },
                                                            items: [
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_read',
                                                                    value: false,
                                                                    boxLabel: 'アップロード',
//																	boxLabel: '読み込み',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_write',
                                                                    value: false,
                                                                    boxLabel: '更新',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                },
                                                                {
                                                                    xtype: 'checkboxfield',
                                                                    flex: 1,
                                                                    cls: 'label-s',
                                                                    name: 'notify_delete',
                                                                    value: false,
                                                                    boxLabel: '削除',
                                                                    inputValue: 'true',
                                                                    uncheckedValue: 'false'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'gridpanel',
                                                            flex: 1,
                                                            itemId: 'selectedNotificationGroupFile',
                                                            autoScroll: true,
                                                            store: 'GroupFileStore',
                                                            selModel: Ext.create('Ext.selection.CheckboxModel', {
                                                            }),
                                                            columns: [
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 120,
                                                                    dataIndex: 'group_name',
                                                                    text: 'グループ名'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 150,
                                                                    dataIndex: 'member_name',
                                                                    text: 'メンバー名'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    width: 70,
                                                                    dataIndex: 'group_notification',
                                                                    text: '更新通知設定'
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'group_description',
                                                                    text: 'グループ説明',
                                                                    flex: 1
                                                                },
                                                                {
                                                                    xtype: 'gridcolumn',
                                                                    hidden: true,
                                                                    dataIndex: 'data_class'
                                                                }
                                                            ],
                                                            dockedItems: [
                                                                {
                                                                    xtype: 'pagingtoolbar',
                                                                    dock: 'bottom',
                                                                    id: 'notification_file_bar',
                                                                    width: 360,
                                                                    displayInfo: true,
                                                                    store: 'GroupFileStore'
                                                                }
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'toolbar',
                                                            height: 33,
                                                            margin: '0 0 1 0',
                                                            ui: 'footer',
                                                            items: [
                                                                {
                                                                    xtype: 'button',
                                                                    handler: function (button, event) {
                                                                        var thisForm = Ext.ComponentQuery.query('#filePrivilege')[0].getForm().getFieldValues();

                                                                        if (thisForm.text === '') {
                                                                            Ext.Msg.show({
                                                                                title: 'フォルダ選択',
                                                                                msg: 'フォルダを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        var thisGrid = Ext.ComponentQuery.query('#selectedNotificationGroupFile')[0];

                                                                        var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                        if (Ext.isEmpty(records)) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ選択',
                                                                                msg: 'グループを選択してください',
                                                                                icon: Ext.Msg.ERROR,
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                            return;
                                                                        }

                                                                        for (var i = 0; i < records.length; i++) {
                                                                            data.push(records[i].data);
                                                                        }

                                                                        var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                        dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                        var dataZ = Ext.apply({request_type: "dismiss_file_group"}, dataY);

                                                                        Ext.Ajax.request({
                                                                            url: 'tdx/updatedata.tdx',
                                                                            method: 'POST',
                                                                            jsonData: dataZ,
                                                                            success: handleSuccess,
                                                                            failure: handleFailure
                                                                        });

                                                                        function handleSuccess(response) {
                                                                            obj = Ext.decode(response.responseText);
                                                                            var request_success = obj.success;

                                                                            if (request_success === false) {
                                                                                var request_errors = obj.errors;
                                                                                Ext.Msg.show({
                                                                                    title: 'グループ除外失敗',
                                                                                    msg: request_errors,
                                                                                    buttons: Ext.Msg.OK
                                                                                });
                                                                            } else {
                                                                                Ext.getCmp('notification_file_bar').moveFirst();
                                                                            }
                                                                            return;
                                                                        }

                                                                        function handleFailure(response) {
                                                                            Ext.Msg.show({
                                                                                title: 'グループ除外失敗',
                                                                                msg: 'サーバとの通信に失敗しました',
                                                                                buttons: Ext.Msg.OK
                                                                            });
                                                                        }
                                                                    },
                                                                    id: 'btn_file_exclude1',
                                                                    margin: 0,
                                                                    width: 110,
                                                                    icon: 'data/small_icon/delete.png',
                                                                    text: 'グループの除外',
                                                                    tooltip: {
                                                                        html: '選択したグループをこのフファイルに対するアクセス権設定グループから除外します。'
                                                                    }
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldcontainer',
                                                    height: 30,
                                                    margin: '0 1 0 1',
                                                    maxHeight: 30,
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function (button, event) {
                                                                var thisForm = Ext.ComponentQuery.query('#filePrivilege')[0].getForm().getFieldValues();

                                                                if (thisForm.text === '') {
                                                                    Ext.Msg.show({
                                                                        title: 'フォルダ選択',
                                                                        msg: 'フォルダを選択してください',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                var thisGrid = Ext.ComponentQuery.query('#selectedNotificationGroupFile')[0];

                                                                var records = thisGrid.getSelectionModel().getSelection(), data = [];

                                                                if (Ext.isEmpty(records)) {
                                                                    Ext.Msg.show({
                                                                        title: 'グループ選択',
                                                                        msg: 'グループを選択してください',
                                                                        icon: Ext.Msg.ERROR,
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                    return;
                                                                }

                                                                for (var i = 0; i < records.length; i++) {
                                                                    data.push(records[i].data);
                                                                }

                                                                var dataY = Ext.apply({members: data}, {data: thisForm});
                                                                dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                                var dataZ = Ext.apply({request_type: "set_file_notification"}, dataY);

                                                                Ext.Ajax.request({
                                                                    url: 'tdx/updatedata.tdx',
                                                                    method: 'POST',
                                                                    jsonData: dataZ,
                                                                    success: handleSuccess,
                                                                    failure: handleFailure
                                                                });

                                                                function handleSuccess(response) {
                                                                    obj = Ext.decode(response.responseText);
                                                                    var request_success = obj.success;

                                                                    if (request_success === false) {
                                                                        var request_errors = obj.errors;
                                                                        Ext.Msg.show({
                                                                            title: '更新通知設定失敗',
                                                                            msg: request_errors,
                                                                            buttons: Ext.Msg.OK
                                                                        });
                                                                    } else {
                                                                        if (thisForm.cont_location === 'folder_a') {
                                                                            Ext.getStore('FileDataStoreA').load();
                                                                        } else if (thisForm.cont_location === 'folder_b') {
                                                                            Ext.getStore('FileDataStoreB').load();
                                                                        }
                                                                        Ext.getCmp('notification_file_bar').moveFirst();
                                                                    }
                                                                    return;
                                                                }

                                                                function handleFailure(response) {
                                                                    Ext.Msg.show({
                                                                        title: '更新通知設定失敗',
                                                                        msg: 'サーバとの通信に失敗しました',
                                                                        buttons: Ext.Msg.OK
                                                                    });
                                                                }

                                                            },
                                                            id: 'btn_file_access1',
                                                            margin: '5 0 0 0',
                                                            icon: 'data/small_icon/checkout.png',
                                                            text: '更新通知設定',
                                                            tooltip: {
                                                                html: 'このファイルに対するアクセス権を設定します。'
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            flex: 0.8,
                            frame: true,
                            id: 'searchGroupFile',
                            autoScroll: true,
                            layout: {
                                align: 'stretch',
                                padding: 0,
                                type: 'vbox'
                            },
                            bodyPadding: 5,
                            items: [
                                {
                                    xtype: 'fieldset',
                                    id: 'privilege_file_search',
                                    margin: '0 0 0 0',
                                    layout: {
                                        type: 'auto'
                                    },
                                    title: 'グループ名のすべてまたは一部で検索します。',
                                    items: [
                                        {
                                            xtype: 'textfield',
                                            margin: 0,
                                            fieldLabel: '検索グループ名',
                                            name: 'searching_group',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'target_hash_key'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function (button, event) {
                                                var formX = this.up('form').getForm().getFieldValues();

                                                if (formX.searching_group === '') {

                                                    Ext.Msg.show({
                                                        title: '検索グループ名入力',
                                                        msg: '検索グループ名を入力してください',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                if (formX.searching_group.trim().length < 1)
                                                {

                                                    Ext.Msg.show({
                                                        //title:'新規グループ名・説明入力',
                                                        //msg: '新規グループ名/説明を入力して下さい。',
                                                        title: '検索グループ名入力',
                                                        msg: '半角、全角スペースのみは許可されません。',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }


                                                var dataY = Ext.apply({session_id: this_session_id}, formX);
                                                dataY = Ext.apply({request_type: "search_group_file_privilege"}, dataY);

                                                /*Ext.Ajax.request({
                                                 url: 'tdx/updatedata.tdx',
                                                 method: 'POST',
                                                 jsonData: dataY,
                                                 success: handleSuccess,
                                                 failure: handleFailure
                                                 });*/


                                                Ext.Msg.show({
                                                    title: 'グループ検索中',
                                                    msg: 'グループ検索中です'
                                                });

                                                /*function handleSuccess(response) {
                                                 obj = Ext.decode(response.responseText);
                                                 var request_success = obj.success;
                                                 
                                                 if (request_success === false) {
                                                 var request_errors = obj.errors;
                                                 Ext.Msg.hide();
                                                 Ext.Msg.show({
                                                 title:'グループ検索失敗',
                                                 msg: request_errors,
                                                 buttons: Ext.Msg.OK
                                                 });
                                                 } else {
                                                 Ext.Msg.hide();
                                                 Ext.getCmp('searched_group_file_bar').moveFirst();
                                                 }
                                                 return;
                                                 }
                                                 
                                                 function handleFailure(response) {
                                                 Ext.Msg.hide();
                                                 Ext.Msg.show({
                                                 title:'グループ検索失敗',
                                                 msg: 'サーバとの通信に失敗しました',
                                                 buttons: Ext.Msg.OK
                                                 });
                                                 }*/

                                            },
                                            margin: '-39 0 0 270',
                                            text: '検索 ',
                                            tooltip: {
                                                html: '指定した条件によって、グループを検索します。'
                                            }
                                        }
                                    ]
                                },
                                {
                                    xtype: 'gridpanel',
                                    flex: 1,
                                    id: 'allGroupMembersFile',
                                    itemId: '',
                                    margin: '5 0 0 0',
                                    padding: '0 0 0 0',
                                    autoScroll: true,
                                    store: 'GroupAllStore',
                                    viewConfig: {
                                        frame: true,
                                        emptyText: '表示するデータがありません。'
                                    },
                                    selModel: Ext.create('Ext.selection.CheckboxModel', {
                                    }),
                                    columns: [
                                        {
                                            xtype: 'gridcolumn',
                                            width: 120,
                                            dataIndex: 'group_name',
                                            text: 'グループ名'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 80,
                                            dataIndex: 'member_name',
                                            text: 'メンバー名'
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            hidden: true,
                                            minWidth: 120,
                                            dataIndex: 'group_description',
                                            hideable: false,
                                            text: 'グループ説明',
                                            flex: 1
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            dataIndex: 'member_description',
                                            text: 'メンバー補助名',
                                            flex: 1
                                        },
                                        {
                                            xtype: 'gridcolumn',
                                            width: 100,
                                            dataIndex: 'member_id',
                                            text: 'メンバーID'
                                        }
                                    ],
                                    features: [
                                        {
                                            ftype: 'grouping',
                                            enableGroupingMenu: false,
                                            groupHeaderTpl: '{name}',
                                            startCollapsed: true
                                        }
                                    ],
                                    dockedItems: [
                                        {
                                            xtype: 'pagingtoolbar',
                                            dock: 'bottom',
                                            id: 'searched_group_file_bar',
                                            displayInfo: true,
                                            store: 'GroupAllStore'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'fieldcontainer',
                                    flex: 1,
                                    height: 30,
                                    margin: '0 0 0 0',
                                    maxHeight: 30,
                                    width: 400,
                                    items: [
                                        {
                                            xtype: 'button',
                                            handler: function (button, event) {
                                                var formX = this.up('form').getForm().getFieldValues();

                                                var componentM = Ext.getCmp('searchGroupFile');
                                                var grid = componentM.down('#allGroupMembersFile');

                                                var records = grid.getSelectionModel().getSelection(), data = [];

                                                if (Ext.isEmpty(records)) {
                                                    Ext.Msg.show({
                                                        title: 'メンバー・グループ選択',
                                                        msg: 'メンバー・グループを選択してください',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                for (var i = 0; i < records.length; i++) {
                                                    data.push(records[i].data);
                                                }

                                                var dataY = Ext.apply(formX, data);
                                                dataY = Ext.apply({session_id: this_session_id}, dataY);
                                                var dataZ = Ext.apply({request_type: "append_my_file_members"}, dataY);

                                                Ext.Ajax.request({
                                                    url: 'tdx/updatedata.tdx',
                                                    jsonData: dataZ,
                                                    method: 'POST',
                                                    success: handleSuccess,
                                                    failure: handleFailure
                                                });

                                                function handleSuccess(response) {
                                                    obj = Ext.decode(response.responseText);
                                                    var request_success = obj.success;

                                                    if (request_success === false) {
                                                        var request_errors = obj.errors;
                                                        Ext.Msg.show({
                                                            title: 'メンバー・グループ追加失敗',
                                                            msg: request_errors,
                                                            buttons: Ext.Msg.OK
                                                        });
                                                    } else {
                                                        Ext.getCmp('privilege_file_bar').moveFirst();
                                                    }
                                                    return;
                                                }

                                                function handleFailure(response) {
                                                    Ext.Msg.show({
                                                        title: 'メンバー・グループ追加失敗',
                                                        msg: 'サーバとの通信に失敗しました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }
                                            },
                                            id: 'btn_add_member_file',
                                            margin: '5 0 0 0',
                                            icon: 'data/small_icon/add.png',
                                            text: 'メンバー・グループ追加',
                                            tooltip: {
                                                html: '選択したグループ、メンバーをこのファイルのアクセス権設定グループとして追加します。'
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'hiddenfield',
                    anchor: '100%',
                    id: 'PrivilegeDsp_request_type',
                    fieldLabel: 'Label',
                    name: 'PrivilegeDsp_request_type'
                }
            ],
            listeners: {
                activate: {
                    fn: me.onPrivilegeDspActivate,
                    scope: me
                },
                deactivate: {
                    fn: me.onPrivilegeDspDeactivate,
                    scope: me
                },
                afterrender: function (component, eOpts)
                {
                    var activeFolders = Ext.getCmp('activeData').getForm().getFieldValues();
                    Ext.getCmp('folderPrivilege').getForm().setValues(
                                {
                                    text: activeFolders.activeFolderA_name,
                                    owner_name: activeFolders.activeFolderA_owner,
                                    hash_key: activeFolders.activeFolderA_hash,
                                    cont_location: activeFolders.activeFolderA_cont_location
                                });
                    var store = Ext.getStore('GroupFolderStore');
                    Ext.apply(store.proxy.extraParams,
                                {
                                    hash_key: activeFolders.activeFolderA_hash
                                });
                    var request_type_field = Ext.getCmp('PrivilegeDsp_request_type');
                    var folder_range = Ext.getCmp("privilege_folder_range");
                    var folder_target = Ext.getCmp("privilege_folder_target");
                    if(activeFolders.activeFolderA_file_type === "folder")
                    {
                        request_type_field.setValue("set_folder_privilege");
                        folder_range.enable();
                        folder_target.enable();
                    }
                    else
                    {
                        request_type_field.setValue("set_file_privilege");
                        folder_range.disable();
                        folder_target.disable();
                    }
                    /*var target = Ext.getCmp('opend_by').value;
                    Ext.getCmp('privilege_folder_bar').moveFirst();
                    var grid = Ext.getCmp(target);
                    var model = grid.getSelectionModel();
                    var record = model.getSelection()[0];
                    if (model.hasSelection())
                    {
                        var folder_name = record.data.folder_name;
                        var owner = record.data.creator;
                        var hash_key = record.data.hash_key;
                        var cont_location = record.data.cont_location;
                        var store = Ext.getStore('GroupFolderStore');
                        Ext.getCmp('folderPrivilege').getForm().setValues(
                                {
                                    text: folder_name,
                                    owner_name: owner,
                                    hash_key: hash_key,
                                    cont_location: cont_location
                                });
                        Ext.apply(store.proxy.extraParams,
                                {
                                    hash_key: hash_key
                                });
                    }*/

                },
                beforedestroy: function ()
                {
                    Ext.getCmp('first_flag').value = 0;
                    var store = Ext.getStore('MemberTreeStore');
                    Ext.apply(store.proxy.extraParams,
                            {
                                group_name: '__clear'
                            });
                    store.load();
                    ;
                }
            }
        });
        me.callParent(arguments);
    },
    onTabClick1: function (button, e, eOpts) {
        var formX = Ext.getCmp('folderPrivilege').getForm().getFieldValues();

        if (formX.text === '') {
            Ext.Msg.show({
                title: 'フォルダ選択',
                msg: 'フォルダツリーにてフォルダを選択してください',
                icon: Ext.Msg.ERROR,
                buttons: Ext.Msg.OK
            });
            return;
        }

    },
    onTabClick: function (button, e, eOpts) {
        var formX = Ext.getCmp('filePrivilege').getForm().getFieldValues();

        if (formX.file_name === '') {
            Ext.Msg.show({
                title: 'ファイル選択',
                msg: 'ファイル全体表示にてファイルを選択してください',
                icon: Ext.Msg.ERROR,
                buttons: Ext.Msg.OK
            });
            return;
        }

    },
    onPrivilegeDspActivate: function (component, eOpts) {
        PrivilegeEdit = true;
        //Ext.getCmp('privilege_folder_bar').moveFirst();
    },
    onPrivilegeDspDeactivate: function (component, eOpts) {
        var PrivilegeEdit = false;
        // TEST
    }

});
