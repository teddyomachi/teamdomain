/*
 * File: app/view/FileProperty.js
 *
 * This file was generated by Sencha Architect version 2.2.2.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.0.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.0.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('TeamDomain.view.FileProperty', {
    extend: 'Ext.window.Window',
    alias: 'widget.FileProperty',
    height: 600,
    hidden: false,
    id: 'fileproperty',
    itemId: 'fileproperty',
    width: 500,
    constrain: true,
    layout: {
        align: 'stretch',
        type: 'vbox'
    },
    title: 'プロパティ',
    initComponent: function () {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'panel',
                    height: 113,
                    id: 'showThumbnail',
                    itemId: 'showThumbnail',
                    padding: '',
                    layout: {
                        align: 'stretch',
                        type: 'hbox'
                    },
                    bodyPadding: 5,
                    items: [
                        {
                            xtype: 'container',
                            flex: 1,
                            itemId: 'thumbnailArea',
                            tpl: [
                                '<table>',
                                '<tr>',
                                '	<td>',
                                '		<tpl>',
                                '			<tpl if="t_file_type == \'mp4\'">',
                                '				<video class="file-Property-video" controls width="250px" height="190px">',
                                '					<source src="{thumbnail_image}" type=\'video/mp4; codecs="avc1.42E01E, mp4a.40.2"\' />',
                                '				//	<p>動画を再生するには<br/>videoタグをサポートした<br/>ブラウザが必要です</p>',
                                '				</video>',
                                '			</tpl>',
                                '			<tpl if="t_file_type == \'ogg\'">',
                                '				<video class="file-Property-video" controls width="250px" height="190px">',
                                '					<source src="{thumbnail_image}" type=\'video/ogg; codecs="theora, vorbis"\' />',
                                '				//	<p>動画を再生するには<br/>videoタグをサポートした<br/>ブラウザが必要です</p>',
                                '				</video>',
                                '			</tpl>',
                                '			<tpl if="t_file_type == \'png\'">',
                                '				<span class="file-Property-icon">',
                                '					<img src="{thumbnail_image}" style="max-width:250px;max-height: 190px" />',
                                '				</span><br/>',
                                '			</tpl>',
                                '		</tpl>',
                                '	</td>',
                                '	<td><img src="data/small_icon/spacer.gif" width="20px" /></td>',
                                '	<td valign="top">',
                                '		<tpl if="lock == 1"> <img src="data/small_icon/my_locked.png"><br/> {id_lc_by}<br/> {name_lc_by}</tpl>',
                                '		<tpl if="lock == 2"> <img src="data/small_icon/locked.png"><br/> {id_lc_by}<br/> {name_lc_by}</tpl>',
                                '		<tpl if="lock == 4"> <img src="data/small_icon/sco.png"><br/> {id_lc_by}<br/> {name_lc_by}</tpl>',
                                '		<tpl if="lock == 8"> <img src="data/small_icon/eco.png"><br/> {id_lc_by}<br/> {name_lc_by}</tpl>',
                                '	</td>',
                                '</tr>',
                                '</table>'
                            ]
                        },
                        {
                            xtype: 'container',
                            itemId: 'btnArea',
                            hidden: true,
                            width: 70,
                            items: [
                                {
                                    xtype: 'button',
                                    itemId: 'enlargeBtn',
                                    text: '拡大表示',
                                    listeners: {
                                        click: {
                                            fn: me.onEnlargeBtnClick,
                                            scope: me
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'tabpanel',
                    flex: 1,
                    activeTab: 0,
                    maxTabWidth: 70,
                    items: [
                        {
                            xtype: 'tabpanel',
                            id: 'thisFileProperty',
                            title: 'プロパティ',
                            activeTab: 0,
                            items: [
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'showFileProperty',
                                    itemId: 'showFileProperty',
                                    autoScroll: true,
                                    bodyPadding: 5,
                                    title: '基本',
                                    items: [
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_file_name',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: 'ファイル名',
                                            labelWidth: 90,
                                            name: 'file_name',
                                            validateOnChange: false,
                                            validateOnBlur: false,
                                            allowBlank: false,
                                            enforceMaxLength: true,
                                            maxLength: 80
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_file_title',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: 'タイトル',
                                            labelWidth: 90,
                                            name: 'title',
                                            allowBlank: false,
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_file_subtitle',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: 'サブタイトル',
                                            labelWidth: 90,
                                            name: 'subtitle',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_file_keyword',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: 'キーワード',
                                            labelWidth: 90,
                                            name: 'keyword',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textareafield',
                                            height: 32,
                                            id: 'change_file_description',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: '説明',
                                            labelWidth: 90,
                                            name: 'description'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function () {
                                                if (Busy === true) {
                                                    return;
                                                }
                                                Busy = true;

                                                var formX = this.up().getForm().getFieldValues();

                                                if (formX.file_name === '') {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        title: 'ファイル選択',
                                                        msg: 'ファイルを選択してください',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                formX = Ext.apply({session_id: this_session_id}, formX);
                                                formX = Ext.apply({request_type: 'change_file_property'}, formX);

                                                Ext.Ajax.request({
                                                    url: 'tdx/updatedata.tdx',
                                                    method: 'POST',
                                                    jsonData: formX,
                                                    success: handleSuccess,
                                                    failure: handleFailure
                                                });

                                                function handleSuccess(response) {
                                                    obj = Ext.decode(response.responseText);
                                                    var request_success = obj.success;

                                                    if (request_success === false) {
                                                        Busy = false;
                                                        var request_errors = obj.errors;
                                                        Ext.Msg.show({
                                                            title: 'ファイル名等変更失敗',
                                                            msg: request_errors,
                                                            buttons: Ext.Msg.OK
                                                        });
                                                    } else {
                                                        requestRefresh();
                                                    }
                                                    return;
                                                }

                                                function handleFailure(response) {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        title: 'ファイル名等変更失敗',
                                                        msg: 'サーバとの通信に失敗しました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }

                                                function requestRefresh() {
                                                    sending_cont_location = formX.cont_location;
                                                    sending_hash_key = formX.hash_key;

                                                    var requestRefreshData = Ext.apply({session_id: this_session_id}, {cont_location: sending_cont_location});
                                                    requestRefreshData = Ext.apply(requestRefreshData, {hash_key: sending_hash_key});
                                                    requestRefreshData = Ext.apply({event_type: "property_change_file_property"}, requestRefreshData);
                                                    requestRefreshData = Ext.apply({request_type: "update_file_list"}, requestRefreshData);

                                                    Ext.Ajax.request({
                                                        url: 'tdx/updatedata.tdx',
                                                        jsonData: requestRefreshData,
                                                        success: handleSuccess3,
                                                        failure: handleFailure3
                                                    });

                                                }

                                                function handleSuccess3(response) {
                                                    obj = Ext.decode(response.responseText);

                                                    var request_success = obj.success;
                                                    var request_status = obj.status;

                                                    if (request_success === false) {
                                                        Busy = false;
                                                        var request_errors = obj.errors;
                                                        Ext.Msg.show({
                                                            title: 'ファイル名等変更失敗',
                                                            msg: request_errors,
                                                            buttons: Ext.Msg.OK
                                                        });
                                                    } else {
                                                        if (formX.cont_location === 'folder_a') {
                                                            Ext.getStore('FileDataStoreA').load();
                                                        } else if (formX.cont_location === 'folder_b') {
                                                            Ext.getStore('FileDataStoreB').load();
                                                        }
                                                        Ext.ComponentQuery.query('#showFileProperty')[0].getForm().reset();
                                                        Ext.ComponentQuery.query('#openFile')[0].getForm().reset();
                                                        Ext.ComponentQuery.query('#ccpdFile')[0].getForm().reset();
                                                        //Ext.ComponentQuery.query('#showThumbnail')[0].update();
                                                        Busy = false;
                                                    }


                                                }

                                                function handleFailure3(response) {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        title: 'サブフォルダの作成失敗',
                                                        msg: 'サーバとの通信に失敗しました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }

                                            },
                                            id: 'btn_change_file_property',
                                            margin: '5 0 5 210',
                                            width: 100,
                                            text: '変更',
                                            tooltip: {
                                                html: 'ファイル名、キーワード、説明を上書きしてから、このボタンを押して下さい。<br/>既に同一フォルダに存在するファイルと同一名を入力した場合には、エラーとなり、変更は実行されません。'
                                            }
                                        },
                                        {
                                            xtype: 'fieldcontainer',
                                            height: 22,
                                            width: 320,
                                            layout: {
                                                align: 'stretch',
                                                type: 'hbox'
                                            },
                                            items: [
                                                {
                                                    xtype: 'displayfield',
                                                    flex: 1,
                                                    margin: '0 2 0 0',
                                                    width: 320,
                                                    fieldLabel: 'ファイルタイプ',
                                                    labelWidth: 120,
                                                    name: 't_file_type'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    flex: 1,
                                                    margin: '0 0 0 3',
                                                    width: 320,
                                                    fieldLabel: 'バージョン',
                                                    labelWidth: 90,
                                                    name: 'file_version'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'displayfield',
                                            hidden: true,
                                            width: 320,
                                            fieldLabel: 'ファイルサイズ',
                                            labelWidth: 90,
                                            name: 'file_exact_size'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            width: 320,
                                            fieldLabel: 'ファイルサイズ',
                                            labelWidth: 120,
                                            name: 'file_exact_disp_size'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: '作成日時',
                                            labelWidth: 90,
                                            name: 'created_at'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            width: 320,
                                            fieldLabel: '作成者',
                                            labelWidth: 90,
                                            name: 'creator'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: '更新日時',
                                            labelWidth: 90,
                                            name: 'updated_at'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            margin: '0 0 5 0',
                                            width: 320,
                                            fieldLabel: '更新者',
                                            labelWidth: 90,
                                            name: 'modifier'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: '所有者',
                                            labelWidth: 90,
                                            name: 'owner'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            width: 320,
                                            fieldLabel: '所有権',
                                            labelWidth: 90,
                                            name: 'ownership'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            width: 320,
                                            fieldLabel: '読取権限',
                                            labelWidth: 90,
                                            name: 'file_readable_status',
                                            fieldStyle: 'background: #EEEEEE;'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            id: 'file_writable_status',
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: '書込権限',
                                            labelWidth: 90,
                                            name: 'file_writable_status',
                                            fieldStyle: 'background: #EEEEEE;'
                                        },
                                        {
                                            xtype: 'displayfield',
                                            hidden: true,
                                            margin: 0,
                                            width: 320,
                                            fieldLabel: 'ファイルURL',
                                            labelWidth: 90,
                                            name: 'url'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function (button, event) {
                                                var value = MyForm.getForm().findField("url").getValue();
                                                if (form.isValid()) {

                                                    Ext.Msg.show({
                                                        title: 'URLの取得',
                                                        msg: form.getValues(true) + ' をクリップボードにコピーしました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }
                                            },
                                            disabled: true,
                                            hidden: true,
                                            margin: '5 0 0 210',
                                            width: 100,
                                            text: 'URL取得'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'showFileExtension',
                                    autoScroll: true,
                                    bodyPadding: 5,
                                    title: '拡張',
                                    items: [
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: '基本情報',
                                            items: [
                                                {
                                                    xtype: 'displayfield',
                                                    id: 'view_file_name',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'ファイル名',
                                                    labelWidth: 80,
                                                    name: 'file_name'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    hidden: true,
                                                    id: 'view_title',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'タイトル',
                                                    labelWidth: 80,
                                                    name: 'title'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    hidden: true,
                                                    id: 'view_subtitle',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'サブタイトル',
                                                    labelWidth: 80,
                                                    name: 'subtitle'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    hidden: true,
                                                    id: 'view_keyword',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'キーワード',
                                                    labelWidth: 80,
                                                    name: 'keyword'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    height: 32,
                                                    id: 'view_file_description',
                                                    width: 300,
                                                    fieldLabel: '説明',
                                                    labelWidth: 80,
                                                    name: 'description'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_duration',
                                            width: 300,
                                            fieldLabel: 'メモ1',
                                            labelWidth: 90,
                                            name: 'duration',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_producer',
                                            width: 300,
                                            fieldLabel: 'メモ2',
                                            labelWidth: 90,
                                            name: 'producer',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_produced_date',
                                            width: 300,
                                            fieldLabel: 'メモ3',
                                            labelWidth: 90,
                                            name: 'produced_date'
                                                    //emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_location',
                                            width: 300,
                                            fieldLabel: 'メモ4',
                                            labelWidth: 90,
                                            name: 'location',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            id: 'change_cast',
                                            width: 300,
                                            fieldLabel: 'メモ5',
                                            labelWidth: 90,
                                            name: 'cast',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_client',
                                            width: 300,
                                            fieldLabel: 'メモ6',
                                            labelWidth: 90,
                                            name: 'client',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_copyright',
                                            width: 300,
                                            fieldLabel: 'メモ7',
                                            labelWidth: 90,
                                            name: 'copyright',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'textfield',
                                            hidden: true,
                                            id: 'change_music',
                                            width: 300,
                                            fieldLabel: 'メモ8',
                                            labelWidth: 90,
                                            name: 'music',
                                            emptyText: '--'
                                        },
                                        {
                                            xtype: 'button',
                                            handler: function () {
                                                var formX = this.up().getForm().getFieldValues();

                                                if (formX.file_name === '') {
                                                    Ext.Msg.show({
                                                        title: 'ファイル選択',
                                                        msg: 'ファイルを選択してください',
                                                        icon: Ext.Msg.ERROR,
                                                        buttons: Ext.Msg.OK
                                                    });
                                                    return;
                                                }

                                                formX = Ext.apply({session_id: this_session_id}, formX);
                                                formX = Ext.apply({request_type: 'change_file_extension'}, formX);

                                                Ext.Ajax.request({
                                                    url: 'tdx/updatedata.tdx',
                                                    method: 'POST',
                                                    jsonData: formX,
                                                    success: handleSuccess,
                                                    failure: handleFailure
                                                });

                                                function handleSuccess(response) {
                                                    obj = Ext.decode(response.responseText);
                                                    var request_success = obj.success;

                                                    if (request_success === false) {
                                                        var request_errors = obj.errors;
                                                        Ext.Msg.show({
                                                            title: 'メモデータ等変更失敗',
                                                            msg: request_errors,
                                                            buttons: Ext.Msg.OK
                                                        });
                                                    } else {
                                                        requestRefresh();
                                                        //if (formX.cont_location === 'folder_a') {
                                                        //	Ext.getStore('FileDataStoreA').load();
                                                        //} else if (formX.cont_location === 'folder_b') {
                                                        //	Ext.getStore('FileDataStoreB').load();
                                                        //}
                                                    }
                                                    return;
                                                }

                                                function handleFailure(response) {
                                                    Ext.Msg.show({
                                                        title: 'メモデータ等変更失敗',
                                                        msg: 'メモデータ等変更に失敗しました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }
                                                function requestRefresh() {
                                                    sending_cont_location = formX.cont_location;
                                                    sending_hash_key = formX.hash_key;

                                                    var requestRefreshData = Ext.apply({session_id: this_session_id}, {cont_location: sending_cont_location});
                                                    requestRefreshData = Ext.apply(requestRefreshData, {hash_key: sending_hash_key});
                                                    requestRefreshData = Ext.apply({event_type: "property_change_file_property"}, requestRefreshData);
                                                    requestRefreshData = Ext.apply({request_type: "update_file_list"}, requestRefreshData);

                                                    Ext.Ajax.request({
                                                        url: 'tdx/updatedata.tdx',
                                                        jsonData: requestRefreshData,
                                                        success: handleSuccess3,
                                                        failure: handleFailure3
                                                    });

                                                }

                                                function handleSuccess3(response) {
                                                    obj = Ext.decode(response.responseText);

                                                    var request_success = obj.success;
                                                    var request_status = obj.status;

                                                    if (request_success === false) {
                                                        Busy = false;
                                                        var request_errors = obj.errors;
                                                        Ext.Msg.show({
                                                            title: 'メモデータ変更失敗(リフレッシュ)',
                                                            msg: request_errors,
                                                            buttons: Ext.Msg.OK
                                                        });
                                                    } else {
                                                        if (formX.cont_location === 'folder_a') {
                                                            Ext.getStore('FileDataStoreA').load();
                                                        } else if (formX.cont_location === 'folder_b') {
                                                            Ext.getStore('FileDataStoreB').load();
                                                        }
                                                        Ext.ComponentQuery.query('#showFileProperty')[0].getForm().reset();
                                                        Ext.ComponentQuery.query('#openFile')[0].getForm().reset();
                                                        Ext.ComponentQuery.query('#ccpdFile')[0].getForm().reset();
                                                        //Ext.ComponentQuery.query('#showThumbnail')[0].update();
                                                        Busy = false;
                                                    }


                                                }

                                                function handleFailure3(response) {
                                                    Busy = false;
                                                    Ext.Msg.show({
                                                        title: 'メモデータ変更失敗（リフレッシュ）',
                                                        msg: 'サーバとの通信に失敗しました',
                                                        buttons: Ext.Msg.OK
                                                    });
                                                }
                                            },
                                            id: 'btn_change_file_extension',
                                            margin: '5 10 5 200',
                                            width: 100,
                                            text: '変更',
                                            tooltip: {
                                                html: 'ファイル名、キーワード、説明を上書きしてから、このボタンを押して下さい。<br/>既に同一フォルダに存在するファイルと同一名を入力した場合には、エラーとなり、変更は実行されません。'
                                            }
                                        }
                                    ]
                                },
                                {
                                    xtype: 'form',
                                    frame: true,
                                    id: 'showFileDetails',
                                    autoScroll: true,
                                    layout: {
                                        align: 'stretch',
                                        type: 'vbox'
                                    },
                                    bodyPadding: 5,
                                    title: '内容詳細',
                                    items: [
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'cont_location'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            fieldLabel: 'Label',
                                            name: 'hash_key'
                                        },
                                        {
                                            xtype: 'fieldset',
                                            title: '基本情報',
                                            items: [
                                                {
                                                    xtype: 'displayfield',
                                                    id: 'view_file_name2',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'ファイル名',
                                                    labelWidth: 80,
                                                    name: 'file_name'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    id: 'view_title2',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'タイトル',
                                                    labelWidth: 80,
                                                    name: 'title'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    id: 'view_subtitle2',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'サブタイトル',
                                                    labelWidth: 80,
                                                    name: 'subtitle'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    id: 'view_keyword2',
                                                    margin: 0,
                                                    width: 300,
                                                    fieldLabel: 'キーワード',
                                                    labelWidth: 80,
                                                    name: 'keyword'
                                                },
                                                {
                                                    xtype: 'displayfield',
                                                    height: 32,
                                                    id: 'view_file_description2',
                                                    width: 300,
                                                    fieldLabel: '説明',
                                                    labelWidth: 80,
                                                    name: 'description'
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'htmleditor',
                                            flex: 1,
                                            id: 'change_details',
                                            width: 320,
                                            fieldLabel: '内容詳細',
                                            labelAlign: 'top',
                                            labelWidth: 90,
                                            name: 'details',
                                            enableColors: false,
                                            enableFont: false,
                                            enableLinks: false,
                                            enableSourceEdit: false
                                        },
                                        {
                                            xtype: 'fieldcontainer',
                                            width: 400,
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    handler: function (button, event) {
                                                        var formX = this.up('form').getForm().getFieldValues();

                                                        formX = Ext.apply({session_id: this_session_id}, formX);
                                                        formX = Ext.apply({request_type: 'change_file_details'}, formX);

                                                        Ext.Ajax.request({
                                                            url: 'tdx/updatedata.tdx',
                                                            method: 'POST',
                                                            jsonData: formX,
                                                            success: handleSuccess,
                                                            failure: handleFailure
                                                        });

                                                        function handleSuccess(response) {
                                                            obj = Ext.decode(response.responseText);
                                                            var request_success = obj.success;

                                                            if (request_success === false) {
                                                                var request_errors = obj.errors;
                                                                Ext.Msg.show({
                                                                    title: '内容詳細変更失敗',
                                                                    msg: request_errors,
                                                                    buttons: Ext.Msg.OK
                                                                });
                                                            } else {
                                                                requestRefresh();
                                                                //if (formX.cont_location === 'folder_a') {
                                                                //	Ext.getStore('FileDataStoreA').load();
                                                                //} else if (formX.cont_location === 'folder_b') {
                                                                //	Ext.getStore('FileDataStoreB').load();
                                                                //}
                                                            }
                                                            return;
                                                        }

                                                        function handleFailure(response) {
                                                            Ext.Msg.show({
                                                                title: '内容詳細変更失敗',
                                                                msg: 'サーバとの通信に失敗しました',
                                                                buttons: Ext.Msg.OK
                                                            });
                                                        }

                                                        function requestRefresh() {
                                                            sending_cont_location = formX.cont_location;
                                                            sending_hash_key = formX.hash_key;

                                                            var requestRefreshData = Ext.apply({session_id: this_session_id}, {cont_location: sending_cont_location});
                                                            requestRefreshData = Ext.apply(requestRefreshData, {hash_key: sending_hash_key});
                                                            requestRefreshData = Ext.apply({event_type: "property_change_file_property"}, requestRefreshData);
                                                            requestRefreshData = Ext.apply({request_type: "update_file_list"}, requestRefreshData);

                                                            Ext.Ajax.request({
                                                                url: 'tdx/updatedata.tdx',
                                                                jsonData: requestRefreshData,
                                                                success: handleSuccess3,
                                                                failure: handleFailure3
                                                            });

                                                        }

                                                        function handleSuccess3(response) {
                                                            obj = Ext.decode(response.responseText);

                                                            var request_success = obj.success;
                                                            var request_status = obj.status;

                                                            if (request_success === false) {
                                                                Busy = false;
                                                                var request_errors = obj.errors;
                                                                Ext.Msg.show({
                                                                    title: '内容詳細変更失敗(リフレッシュ)',
                                                                    msg: request_errors,
                                                                    buttons: Ext.Msg.OK
                                                                });
                                                            } else {
                                                                if (formX.cont_location === 'folder_a') {
                                                                    Ext.getStore('FileDataStoreA').load();
                                                                } else if (formX.cont_location === 'folder_b') {
                                                                    Ext.getStore('FileDataStoreB').load();
                                                                }
                                                                Ext.ComponentQuery.query('#showFileProperty')[0].getForm().reset();
                                                                Ext.ComponentQuery.query('#openFile')[0].getForm().reset();
                                                                Ext.ComponentQuery.query('#ccpdFile')[0].getForm().reset();
                                                                //Ext.ComponentQuery.query('#showThumbnail')[0].update();
                                                                Busy = false;
                                                            }
                                                        }

                                                        function handleFailure3(response) {
                                                            Busy = false;
                                                            Ext.Msg.show({
                                                                title: '内容詳細変更失敗（リフレッシュ）',
                                                                msg: 'サーバとの通信に失敗しました',
                                                                buttons: Ext.Msg.OK
                                                            });
                                                        }


                                                    },
                                                    id: 'btn_change_file_details',
                                                    margin: '0 0 0 215',
                                                    width: 100,
                                                    text: '変更',
                                                    tooltip: {
                                                        html: '動画のあらすじなどを入力して下さい。'
                                                    }
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ],
                    listeners: {
                        afterrender: {
                            fn: me.onFilePropertyAfterRender,
                            scope: me
                        }
                    }
                }
            ]
        });

        me.callParent(arguments);
    },
    onEnlargeBtnClick: function (button, e, eOpts) {
        var thisContents = Ext.ComponentQuery.query('#thumbnailArea')[0];
        var enlarge_win = Ext.create('TeamDomain.view.EnlargeWin');
        enlarge_win.update(thisContents.data);
        enlarge_win = enlarge_win.show();

    },
    onFilePropertyAfterRender: function (component, eOpts) {
        var grid = Ext.getCmp('listGridPanelA');
        var model = grid.getSelectionModel();
        if (model.hasSelection()) {
            try {
                record = model.getSelection()[0];

                Ext.getCmp('thumbnailArea').update(record.data);

                if (record.data.t_file_type === 'mp4' || record.data.t_file_type === 'ogg') {
                    Ext.ComponentQuery.query('#enlargeBtn')[0].show();
                    SelectedFileType = record.data.file_type;
                    SelectedFileUrl = record.data.url;
                    SelectedFileThum = record.data.thumbnail_image;
                } else {
                    Ext.ComponentQuery.query('#enlargeBtn')[0].hide();
                }
                Ext.getCmp('#showFileProperty').loadRecord(record);
                Ext.getCmp('#showFileExtension').loadRecord(record);
                Ext.getCmp('#showFileDetails').loadRecord(record);

                // ファイルサイズ
                var fileSizeUpper = record.data.file_size_upper;
                var fileSize = record.data.file_size;
                var fileSizeReal = fileSizeUpper * Math.pow(2, 31) + fileSize;
                if (fileSizeReal === 0 || fileSizeReal === "") {
                    file_size_formatted = '0 B';
                } else {
                    file_size_formatted = Ext.util.Format.number(fileSizeReal, '0,000');
                    file_size_formatted = file_size_formatted + ' B';
                }

                // 作成日
                var DateCreated = selected[0].data.created_at;
                var DateCreated_formated;
                if (DateCreated === 0 || DateCreated === "") {
                    DateCreated_formated = ' - ';
                } else {
                    DateCreated_formated = Ext.util.Format.date(DateCreated, 'Y-m-d H:i:s O');
                }

                // 更新日
                var DateModified = selected[0].data.updated_at;
                var DateModified_formated;
                if (DateModified === 0 || DateModified === "") {
                    DateModified_formated = ' - ';
                } else {
                    DateModified_formated = Ext.util.Format.date(DateModified, 'Y-m-d H:i:s O');
                }

                Ext.getCmp('showFileProperty').getForm().setValues({
                    file_exact_disp_size: file_size_formatted,
                    created_at: DateCreated_formated,
                    updated_at: DateModified_formated
                });

            } catch (e) {
                Ext.Msg.show({
                    msg: e,
                    buttons: Ext.Msg.OK
                });
            }
        }
    }
});
